<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cleaning Service</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="quote.css">
    
    <!-- Favicon -->
    <link href="https://img.icons8.com/?size=80&id=BTNAqD2IIXSp&format=png" rel="icon">
</head>
<body>
    <!-- Fixed Header -->
    <header class="fixed-header">
        <div class="header-content">
            <div class="logo">TimelessTidy</div>
            
            <div class="step-indicator">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Get Quote</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Choose Time</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Your Details</div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">Payment</div>
                </div>
            </div>
            
            <div class="order-summary-container">
                <div class="order-summary-toggle" onclick="toggleOrderSummary()">
                    <span id="summary-total-amount">£0.00</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="order-summary-dropdown">
                    <h3>Order Summary</h3>
                    <div class="summary-item">
                        <span class="summary-title">Service:</span>
                        <span id="dropdown-summary-service">Standard Cleaning</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-title">Bedrooms:</span>
                        <span id="dropdown-summary-bedrooms">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-title">Bathrooms:</span>
                        <span id="dropdown-summary-bathrooms">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-title">Extra Tasks:</span>
                        <span id="dropdown-summary-extras">None</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-title">Work Hours:</span>
                        <span id="dropdown-summary-hours">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-title">Frequency:</span>
                        <span id="dropdown-summary-frequency">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-title">Date:</span>
                        <span id="dropdown-summary-date">-</span>
                    </div>
                    <div class="summary-total">
                        <span>Estimated Total:</span>
                        <span id="dropdown-summary-total">£0.00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="form-container">
            <!-- Step 1: Get Your Quote -->
            <form id="signup-form">
                <div class="form-step active" data-step="1">
                    <h2>Customize Your Clean</h2>
                    <div class="form-group">
                        <label for="postal-code">Postal Code</label>
                        <input type="text" id="postal-code" name="postal-code" required placeholder="Enter your postal code">
                    </div>
                    <div class="form-group">
                        <label for="bedrooms">How many bedrooms need cleaning?</label>
                        <select id="bedrooms" name="bedrooms" required>
                            <option value="">Select</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5+</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bathrooms">How many bathrooms need cleaning?</label>
                        <select id="bathrooms" name="bathrooms" required>
                            <option value="">Select</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5+</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Extra tasks (optional)</label>
                        <div class="extra-tasks-container">
                            <div class="extra-task-option" data-task="ironing" data-cost="15">
                                <i class="fas fa-iron"></i>
                                <div>Ironing</div>
                                <small>+£15</small>
                            </div>
                            <div class="extra-task-option" data-task="laundry" data-cost="20">
                                <i class="fas fa-tshirt"></i>
                                <div>Laundry</div>
                                <small>+£20</small>
                            </div>
                            <div class="extra-task-option" data-task="windows" data-cost="25">
                                <i class="fas fa-window-maximize"></i>
                                <div>Inside windows</div>
                                <small>+£25</small>
                            </div>
                            <div class="extra-task-option" data-task="fridge" data-cost="30">
                                <i class="fas fa-refrigerator"></i>
                                <div>Inside fridge</div>
                                <small>+£30</small>
                            </div>
                            <div class="extra-task-option" data-task="oven" data-cost="35">
                                <i class="fas fa-temperature-high"></i>
                                <div>Inside oven</div>
                                <small>+£35</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Select work hours</label>
                        <div id="work-hours-recommendation" style="font-style: italic; margin-bottom: 10px; color: var(--primary-color);"></div>
                        <div class="option-blocks">
                            <div class="option-block" data-hours="2.0">2.0 hours</div>
                            <div class="option-block" data-hours="2.5">2.5 hours</div>
                            <div class="option-block" data-hours="3.0">3.0 hours</div>
                            <div class="option-block" data-hours="3.5">3.5 hours</div>
                            <div class="option-block" data-hours="4.0">4.0 hours</div>
                            <div class="option-block" data-hours="4.5">4.5 hours</div>
                            <div class="option-block" data-hours="5.0">5.0 hours</div>
                            <div class="option-block" data-hours="5.5">5.5 hours</div>
                            <div class="option-block" data-hours="6.0">6.0 hours</div>
                            <div class="option-block" data-hours="6.5">6.5 hours</div>
                            <div class="option-block" data-hours="7.0">7.0 hours</div>
                            <div class="option-block" data-hours="7.5">7.5 hours</div>
                            <div class="option-block" data-hours="8.0">8.0 hours</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Cleaning products?</label>
                        <p style="margin-bottom: 10px; font-size: 14px; color: #666;">Includes sprays and cloths. Your Housekeeper cannot bring a vacuum, mop or bucket</p>
                        <div class="option-blocks" style="grid-template-columns: repeat(2, 1fr);">
                            <div class="option-block" data-products="bring">Bring cleaning products</div>
                            <div class="option-block" data-products="provide">I will provide</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>How often?</label>
                        <p style="margin-bottom: 10px; font-size: 14px; color: #666;">You can keep the same cleaner for recurring cleans. You can change or cancel any time.</p>
                        <div class="option-blocks" style="grid-template-columns: repeat(4, 1fr);">
                            <!--div class="option-block" data-frequency="more-than-weekly">More than weekly</div-->
                            <div class="option-block" data-frequency="weekly">Every week</div>
                            <div class="option-block" data-frequency="biweekly">Every 2 weeks</div>
                            <div class="option-block" data-frequency="one-off">One-off</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email address</label>
                        <input type="email" id="email" name="email" required placeholder="Enter your email">
                        <div class="checkbox-container">
                            <input type="checkbox" id="newsletter" name="newsletter" checked>
                            <label for="newsletter" style="font-weight: normal;">Receive our newsletter and promotions</label>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <div></div>
                        <button type="button" class="btn" onclick="nextStep()">Continue</button>
                    </div>
                </div>
                
                <!-- Step 2: Choose Your Time -->
                <div class="form-step" data-step="2">
                    <h2>Choose Your Time</h2>
                    <div class="form-group">
                        <label>How can your cleaner access the property?</label>
                        <div class="option-blocks" style="grid-template-columns: repeat(2, 1fr);">
                            <div class="option-block" data-access="keys">Spare keys</div>
                            <div class="option-block" data-access="someone">Someone at home</div>
                            <div class="option-block" data-access="concierge">Concierge</div>
                            <div class="option-block" data-access="keysafe">Key safe</div>
                            <div class="option-block" data-access="hidden">Key hidden</div>
                        </div>
                        <div id="access-details-container" style="margin-top: 15px; display: none;">
                            <div id="concierge-details" class="access-details">
                                <label for="concierge-location">Where is the concierge?</label>
                                <input type="text" id="concierge-location" name="concierge-location">
                            </div>
                            <div id="keysafe-details" class="access-details">
                                <label for="keysafe-location">Where is the key safe?</label>
                                <input type="text" id="keysafe-location" name="keysafe-location">
                                <label for="keysafe-code" style="margin-top: 10px;">Passcode</label>
                                <input type="text" id="keysafe-code" name="keysafe-code">
                            </div>
                            <div id="hidden-details" class="access-details">
                                <label for="hidden-location">Where is the key hidden?</label>
                                <input type="text" id="hidden-location" name="hidden-location">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Do you have any pets?</label>
                        <p style="margin-bottom: 10px; font-size: 14px; color: #666;">We'll display times of pet-friendly cleaners</p>
                        <div class="pet-options">
                            <div class="option-block" data-pets="yes">Yes, I have pets</div>
                            <div class="option-block" data-pets="no">No, I don't have any pets</div>
                        </div>
                        <div id="pet-types-container" class="pet-type-container">
                            <label style="display: block; margin-bottom: 10px;">What type of pets?</label>
                            <div class="pet-type-option" data-pet-type="cat">Cat</div>
                            <div class="pet-type-option" data-pet-type="dog">Dog</div>
                            <div class="pet-type-option" data-pet-type="other">Other</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>When would you like your first clean?</label>
                        <p style="margin-bottom: 10px; font-size: 14px; color: #666;">Cleaners work from 07:00-20:00, Monday-Sunday</p>
                        <div class="calendar-container">
                            <div class="calendar-header">
                                <button type="button" id="prev-month"><i class="fas fa-chevron-left"></i></button>
                                <h4 id="current-month-year">June 2023</h4>
                                <button type="button" id="next-month"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="calendar-grid" id="calendar-days-header">
                                <div class="calendar-day-header">Sun</div>
                                <div class="calendar-day-header">Mon</div>
                                <div class="calendar-day-header">Tue</div>
                                <div class="calendar-day-header">Wed</div>
                                <div class="calendar-day-header">Thu</div>
                                <div class="calendar-day-header">Fri</div>
                                <div class="calendar-day-header">Sat</div>
                            </div>
                            <div class="calendar-grid" id="calendar-days"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>What time would you like your cleaner to arrive?</label>
                        <div class="time-options">
                            <h4 style="margin: 15px 0 10px 0;">Morning arrival (9:00am-12 noon)</h4>
                            <div class="time-slots-container" id="morning-slots"></div>
                            
                            <h4 style="margin: 15px 0 10px 0;">Afternoon arrival (12 noon-5pm)</h4>
                            <div class="time-slots-container" id="afternoon-slots"></div>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
                        <button type="button" class="btn" onclick="nextStep()">Continue</button>
                    </div>
                </div>
                
                <!-- Step 3: Your Details -->
                <div class="form-step" data-step="3">
                    <h2>Your Details</h2>
                    <div class="form-group">
                        <label for="full-name">Full Name</label>
                        <input type="text" id="full-name" name="full-name" required placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="mobile">Mobile Number</label>
                        <input type="tel" id="mobile" name="mobile" required placeholder="Enter your mobile number">
                    </div>
                    <div class="form-group">
                        <label for="address1">Address Line 1</label>
                        <input type="text" id="address1" name="address1" required placeholder="Enter your address">
                    </div>
                    <div class="form-group">
                        <label for="address2">Address Line 2 (optional)</label>
                        <input type="text" id="address2" name="address2" placeholder="Apartment, suite, unit, etc.">
                    </div>
                    <div class="form-group">
                        <label for="city">City</label>
                        <input type="text" id="city" name="city" required placeholder="Enter your city">
                    </div>
                    <div class="form-group">
                        <label for="postal-code-confirm">Postal Code</label>
                        <input type="text" id="postal-code-confirm" name="postal-code-confirm" required readonly>
                    </div>
                    
                    <!-- Add upload section -->
                    <div class="form-group">
                        <label>Upload Photos/Videos (Optional)</label>
                        <div class="upload-section">
                            <input type="file" id="file-upload" accept="image/*,video/*" multiple 
                                   style="display: none;" onchange="handleFileUpload(event)">
                            <button type="button" class="btn btn-secondary" 
                                    onclick="document.getElementById('file-upload').click()">
                                <i class="fas fa-upload"></i> Choose Files
                            </button>
                            <p style="margin-top: 10px; color: #666;">Max 5 files (images or videos)</p>
                            <div class="file-preview-container" id="file-preview-container"></div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
                        <button type="button" class="btn" onclick="nextStep()">Continue</button>
                    </div>
                </div>

                <!-- Step 4: Order Summary and Payment -->
                <div class="form-step" data-step="4">
                    <h2>Order Summary</h2>
                    <div class="order-summary-full">
                        <div class="summary-item">
                            <span class="summary-title">Service:</span>
                            <span id="full-summary-service">Standard Cleaning</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-title">Bedrooms:</span>
                            <span id="full-summary-bedrooms">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-title">Bathrooms:</span>
                            <span id="full-summary-bathrooms">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-title">Extra Tasks:</span>
                            <span id="full-summary-extras">None</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-title">Work Hours:</span>
                            <span id="full-summary-hours">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-title">Frequency:</span>
                            <span id="full-summary-frequency">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-title">Date:</span>
                            <span id="full-summary-date">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-title">Time:</span>
                            <span id="full-summary-time">-</span>
                        </div>
                        <div class="summary-total">
                            <span>Total Amount:</span>
                            <span id="full-summary-total">£0.00</span>
                        </div>
                    </div>

                    <div class="checkbox-container">
                        <input type="checkbox" id="terms" name="terms" required>
                        <label for="terms" style="font-weight: normal;">I agree to the terms and conditions</label>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
                        <button type="button" class="btn" id="pay-now-button" onclick="processPayment()">Pay Now</button>
                    </div>
                </div>
            </form>
        </div>
        
        <div class="sidebar">
            <!-- FAQ and Testimonial (visible only on desktop) -->
            <div class="hidden-mobile">
                <div class="testimonial-container">
                    <h3>What Our Customers Say</h3>
                    <div class="testimonial">
                        <div class="testimonial-avatar">
                            <img src="https://randomuser.me/api/portraits/women/43.jpg" alt="Happy Customer">
                        </div>
                        <div class="testimonial-content">
                            <div class="testimonial-rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                            <p>"The cleaner did an amazing job! My house has never been so spotless."</p>
                        </div>
                    </div>
                </div>
                
                <div class="faq-container">
                    <h3>Frequently Asked Questions</h3>
                    <div class="faq-item">
                        <div class="faq-question">What's included in the standard cleaning?</div>
                        <div class="faq-answer">Our standard cleaning includes dusting, vacuuming, mopping, bathroom cleaning, and kitchen cleaning.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">Do I need to be home during the cleaning?</div>
                        <div class="faq-answer">No, many of our clients provide us with access to their home. We're fully insured for your peace of mind.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">What's your cancellation policy?</div>
                        <div class="faq-answer">You can cancel or reschedule up to 24 hours before your appointment without any charges.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">Do you bring your own supplies?</div>
                        <div class="faq-answer">Yes, we bring all necessary cleaning supplies and equipment. You only need to provide electricity and water.</div>
                    </div>
                </div>
            </div>
            
            <!-- Security Info (shown in step 4) -->
            <div id="security-container" class="security-container" style="display: none;">
                <div class="security-info">
                    <i class="fas fa-lock"></i>
                    <span>Your payment details are encrypted and secured</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 4;
        let selectedExtras = [];
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let uploadedFiles = [];
        
        // Initialize the form
        document.addEventListener('DOMContentLoaded', function() {
            updateStepIndicator();
            generateTimeSlots();
            generateCalendar();
            setupEventListeners();
            
            // Set minimum date for date picker to today
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('cleaning-date')) {
                document.getElementById('cleaning-date').min = today;
            }
            
            // Form submission handler
            document.getElementById('signup-form').addEventListener('submit', function(e) {
                e.preventDefault();
            });
        });
        
        function setupEventListeners() {
            // Extra tasks selection
            document.querySelectorAll('.extra-task-option').forEach(option => {
                option.addEventListener('click', function() {
                    this.classList.toggle('selected');
                    updateSelectedExtras();
                    updateSummary();
                });
            });
            
            // Option blocks selection
            document.querySelectorAll('.option-block').forEach(block => {
                block.addEventListener('click', function() {
                    // Remove selected class from siblings
                    this.parentElement.querySelectorAll('.option-block').forEach(b => {
                        b.classList.remove('selected');
                    });
                    // Add to clicked element
                    this.classList.add('selected');
                    
                    // Special handling for pet options
                    if (this.dataset.pets === 'yes') {
                        document.getElementById('pet-types-container').style.display = 'block';
                    } else if (this.dataset.pets === 'no') {
                        document.getElementById('pet-types-container').style.display = 'none';
                    }
                    
                    // Special handling for access options
                    if (this.dataset.access) {
                        showAccessDetails(this.dataset.access);
                    }
                    
                    updateSummary();
                });
            });
            
            // Pet type selection
            document.querySelectorAll('.pet-type-option').forEach(option => {
                option.addEventListener('click', function() {
                    this.classList.toggle('selected');
                });
            });
            
            // Calendar navigation
            document.getElementById('prev-month').addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                generateCalendar();
            });
            
            document.getElementById('next-month').addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                generateCalendar();
            });
            
            // Time slot selection
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('time-slot')) {
                    // Remove selected class from siblings in same container
                    e.target.parentElement.querySelectorAll('.time-slot').forEach(s => {
                        s.classList.remove('selected');
                    });
                    // Add to clicked element
                    e.target.classList.add('selected');
                    updateSummary();
                }
            });
            
            // Update work hours recommendation when bedrooms/bathrooms change
            document.getElementById('bedrooms').addEventListener('change', updateWorkHoursRecommendation);
            document.getElementById('bathrooms').addEventListener('change', updateWorkHoursRecommendation);
            
            // Update summary when inputs change
            document.getElementById('bedrooms').addEventListener('change', updateSummary);
            document.getElementById('bathrooms').addEventListener('change', updateSummary);
        }
        
        function toggleOrderSummary() {
            const dropdown = document.querySelector('.order-summary-dropdown');
            const toggle = document.querySelector('.order-summary-toggle');
            
            dropdown.classList.toggle('active');
            toggle.classList.toggle('active');
        }
        
        function toggleFAQ(question) {
            question.classList.toggle('active');
            const answer = question.nextElementSibling;
            answer.classList.toggle('show');
        }
        
        function updateSelectedExtras() {
            selectedExtras = [];
            document.querySelectorAll('.extra-task-option.selected').forEach(option => {
                selectedExtras.push({
                    name: option.querySelector('div').textContent,
                    cost: parseFloat(option.dataset.cost)
                });
            });
        }
        
        function updateWorkHoursRecommendation() {
            const bedrooms = parseInt(document.getElementById('bedrooms').value) || 0;
            const bathrooms = parseInt(document.getElementById('bathrooms').value) || 0;
            
            if (bedrooms > 0 || bathrooms > 0) {
                // Base hours calculation
                let recommendedHours = 2.0; // Base
                recommendedHours += bedrooms * 0.5;
                recommendedHours += bathrooms * 0.5;
                
                // Add extra time for selected extras
                selectedExtras.forEach(extra => {
                    recommendedHours += 0.5; // Add 30 minutes per extra task
                });
                
                // Round to nearest 0.5
                recommendedHours = Math.round(recommendedHours * 2) / 2;
                
                // Ensure it's within our range
                recommendedHours = Math.max(2.0, Math.min(8.0, recommendedHours));
                
                document.getElementById('work-hours-recommendation').textContent = 
                    `Recommended: ${recommendedHours} hours based on your selection`;
                
                // Highlight the recommended option
                document.querySelectorAll('.option-block[data-hours]').forEach(block => {
                    block.classList.remove('recommended');
                    if (parseFloat(block.dataset.hours) === recommendedHours) {
                        block.classList.add('recommended');
                        block.style.borderColor = 'var(--primary-color)';
                        block.style.boxShadow = '0 0 0 2px rgba(74, 111, 165, 0.2)';
                    }
                });
            } else {
                document.getElementById('work-hours-recommendation').textContent = '';
            }
        }
        
        function showAccessDetails(accessMethod) {
            const detailsContainer = document.getElementById('access-details-container');
            const conciergeDetails = document.getElementById('concierge-details');
            const keysafeDetails = document.getElementById('keysafe-details');
            const hiddenDetails = document.getElementById('hidden-details');
            
            // Hide all first
            conciergeDetails.style.display = 'none';
            keysafeDetails.style.display = 'none';
            hiddenDetails.style.display = 'none';
            
            // Show the appropriate one
            if (accessMethod === 'concierge') {
                detailsContainer.style.display = 'block';
                conciergeDetails.style.display = 'block';
            } else if (accessMethod === 'keysafe') {
                detailsContainer.style.display = 'block';
                keysafeDetails.style.display = 'block';
            } else if (accessMethod === 'hidden') {
                detailsContainer.style.display = 'block';
                hiddenDetails.style.display = 'block';
            } else {
                detailsContainer.style.display = 'none';
            }
        }
        
        function generateTimeSlots() {
            const morningSlots = document.getElementById('morning-slots');
            const afternoonSlots = document.getElementById('afternoon-slots');
            
            // Clear existing slots
            morningSlots.innerHTML = '';
            afternoonSlots.innerHTML = '';
            
            // Generate morning slots (9:00am - 12:00pm in 30-minute intervals)
            let time = new Date();
            time.setHours(9, 0, 0, 0);
            
            const endMorning = new Date();
            endMorning.setHours(12, 0, 0, 0);
            
            while (time <= endMorning) {
                const slot = document.createElement('div');
                slot.className = 'time-slot';
                
                const endTime = new Date(time.getTime() + 30 * 60000);
                const timeString = `${time.getHours()}:${time.getMinutes() === 0 ? '00' : '30'}-${endTime.getHours()}:${endTime.getMinutes() === 0 ? '00' : '30'}${time.getHours() >= 12 ? 'pm' : 'am'}`;
                
                slot.textContent = timeString;
                slot.dataset.time = timeString;
                
                morningSlots.appendChild(slot);
                
                time = new Date(time.getTime() + 30 * 60000);
            }
            
            // Generate afternoon slots (12:00pm - 5:00pm in 30-minute intervals)
            time.setHours(12, 0, 0, 0);
            const endAfternoon = new Date();
            endAfternoon.setHours(17, 0, 0, 0);
            
            while (time <= endAfternoon) {
                const slot = document.createElement('div');
                slot.className = 'time-slot';
                
                const endTime = new Date(time.getTime() + 30 * 60000);
                const timeString = `${time.getHours()}:${time.getMinutes() === 0 ? '00' : '30'}-${endTime.getHours()}:${endTime.getMinutes() === 0 ? '00' : '30'}pm`;
                
                slot.textContent = timeString;
                slot.dataset.time = timeString;
                
                afternoonSlots.appendChild(slot);
                
                time = new Date(time.getTime() + 30 * 60000);
            }
        }
        
        function generateCalendar() {
            const calendarDays = document.getElementById('calendar-days');
            const monthYearDisplay = document.getElementById('current-month-year');
            
            // Clear existing calendar days
            calendarDays.innerHTML = '';
            
            // Set month and year display
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            monthYearDisplay.textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            // Get first day of month and total days in month
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Get today's date for comparison
            const today = new Date();
            const currentDate = today.getDate();
            const currentMonthNow = today.getMonth();
            const currentYearNow = today.getFullYear();
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-day disabled';
                emptyCell.textContent = '';
                calendarDays.appendChild(emptyCell);
            }
            
            // Add cells for each day of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                dayCell.textContent = day;
                
                // Disable past dates
                if (currentYear > currentYearNow || 
                    (currentYear === currentYearNow && currentMonth > currentMonthNow) ||
                    (currentYear === currentYearNow && currentMonth === currentMonthNow && day >= currentDate)) {
                    dayCell.addEventListener('click', function() {
                        document.querySelectorAll('#calendar-days .calendar-day').forEach(cell => {
                            cell.classList.remove('selected');
                        });
                        this.classList.add('selected');
                        updateSummary();
                    });
                } else {
                    dayCell.classList.add('disabled');
                }
                
                calendarDays.appendChild(dayCell);
            }
        }
        
        function updateStepIndicator() {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active', 'completed');
                const stepNumber = parseInt(step.dataset.step);
                
                if (stepNumber === currentStep) {
                    step.classList.add('active');
                } else if (stepNumber < currentStep) {
                    step.classList.add('completed');
                }
            });
            
            // Show/hide security info in sidebar
            if (currentStep === 4) {
                document.getElementById('security-container').style.display = 'block';
            } else {
                document.getElementById('security-container').style.display = 'none';
            }
        }
        
        function showStep(stepNumber) {
            document.querySelectorAll('.form-step').forEach(step => {
                step.classList.remove('active');
                if (parseInt(step.dataset.step) === stepNumber) {
                    step.classList.add('active');
                }
            });
            
            currentStep = stepNumber;
            updateStepIndicator();
            
            // When going to step 3, populate the postal code from step 1
            if (stepNumber === 3) {
                const postalCode = document.getElementById('postal-code').value;
                document.getElementById('postal-code-confirm').value = postalCode;
            }
            
            // When going to step 4, update the full summary
            if (stepNumber === 4) {
                updateFullSummary();
            }
        }
        
        function nextStep() {
            if (validateStep(currentStep)) {
                updateSummary();
                if (currentStep < totalSteps) {
                    showStep(currentStep + 1);
                }
            }
        }
        
        function prevStep() {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        }
        
        function validateStep(step) {
            // Step 1 validation
            if (step === 1) {
                const postalCode = document.getElementById('postal-code').value;
                const bedrooms = document.getElementById('bedrooms').value;
                const bathrooms = document.getElementById('bathrooms').value;
                const email = document.getElementById('email').value;
                
                if (!postalCode || !bedrooms || !bathrooms || !email) {
                    alert('Please fill in all required fields to get your quote');
                    return false;
                }
                
                // Validate email format
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    alert('Please enter a valid email address');
                    return false;
                }
                
                // Check if work hours are selected
                const workHoursSelected = document.querySelector('.option-block[data-hours].selected');
                if (!workHoursSelected) {
                    alert('Please select work hours');
                    return false;
                }
                
                // Check if products option is selected
                const productsSelected = document.querySelector('.option-block[data-products].selected');
                if (!productsSelected) {
                    alert('Please select cleaning products option');
                    return false;
                }
                
                // Check if frequency is selected
                const frequencySelected = document.querySelector('.option-block[data-frequency].selected');
                if (!frequencySelected) {
                    alert('Please select cleaning frequency');
                    return false;
                }
            }
            
            // Step 2 validation
            if (step === 2) {
                // Check if access method is selected
                const accessSelected = document.querySelector('.option-block[data-access].selected');
                if (!accessSelected) {
                    alert('Please select how your cleaner can access the property');
                    return false;
                }
                
                // If concierge, keysafe or hidden is selected, check details are filled
                const accessMethod = accessSelected.dataset.access;
                if (accessMethod === 'concierge' && !document.getElementById('concierge-location').value) {
                    alert('Please specify where the concierge is located');
                    return false;
                }
                
                if (accessMethod === 'keysafe' && (!document.getElementById('keysafe-location').value || !document.getElementById('keysafe-code').value)) {
                    alert('Please specify the key safe location and passcode');
                    return false;
                }
                
                if (accessMethod === 'hidden' && !document.getElementById('hidden-location').value) {
                    alert('Please specify where the key is hidden');
                    return false;
                }
                
                // Check if pets option is selected
                const petsSelected = document.querySelector('.option-block[data-pets].selected');
                if (!petsSelected) {
                    alert('Please select if you have any pets');
                    return false;
                }
                
                // If pets are yes, check at least one type is selected
                if (petsSelected.dataset.pets === 'yes') {
                    const petTypesSelected = document.querySelectorAll('.pet-type-option.selected');
                    if (petTypesSelected.length === 0) {
                        alert('Please select what type of pets you have');
                        return false;
                    }
                }
                
                // Check if a date is selected
                const dateSelected = document.querySelector('#calendar-days .calendar-day.selected');
                if (!dateSelected) {
                    alert('Please select a date for your first clean');
                    return false;
                }
                
                // Check if a time slot is selected
                const timeSelected = document.querySelector('.time-slot.selected');
                if (!timeSelected) {
                    alert('Please select a time slot for your cleaner to arrive');
                    return false;
                }
            }
            
            // Step 3 validation
            if (step === 3) {
                const fullName = document.getElementById('full-name').value;
                const mobile = document.getElementById('mobile').value;
                const address1 = document.getElementById('address1').value;
                const city = document.getElementById('city').value;
                
                if (!fullName || !mobile || !address1 || !city) {
                    alert('Please fill in all required fields');
                    return false;
                }
                
                // Simple mobile validation
                const mobileRegex = /^[0-9]{10,15}$/;
                if (!mobileRegex.test(mobile)) {
                    alert('Please enter a valid mobile number');
                    return false;
                }
            }
            
            // Step 4 validation
            if (step === 4) {
                const termsChecked = document.getElementById('terms').checked;
                
                if (!termsChecked) {
                    alert('Please agree to the terms and conditions');
                    return false;
                }
            }
            
            return true;
        }
        
        function updateSummary() {
            // Get all values
            const bedrooms = document.getElementById('bedrooms').value || '-';
            const bathrooms = document.getElementById('bathrooms').value || '-';
            
            // Get selected extras
            updateSelectedExtras();
            const extrasText = selectedExtras.length > 0 ? 
                selectedExtras.map(e => e.name).join(', ') : 'None';
            const extrasCost = selectedExtras.reduce((sum, extra) => sum + extra.cost, 0);
            
            // Get work hours
            const workHoursOption = document.querySelector('.option-block[data-hours].selected');
            const workHours = workHoursOption ? workHoursOption.dataset.hours + ' hours' : '-';
            
            // Get cleaning products
            const productsOption = document.querySelector('.option-block[data-products].selected');
            const products = productsOption ? 
                (productsOption.dataset.products === 'bring' ? 'We bring' : 'I provide') : '-';
            
            // Get frequency
            const frequencyOption = document.querySelector('.option-block[data-frequency].selected');
            let frequency = '-';
            if (frequencyOption) {
                switch(frequencyOption.dataset.frequency) {
                    case 'more-than-weekly': frequency = 'More than weekly'; break;
                    case 'weekly': frequency = 'Every week'; break;
                    case 'biweekly': frequency = 'Every 2 weeks'; break;
                    case 'one-off': frequency = 'One-off'; break;
                }
            }
            
            // Get selected date
            const dateSelected = document.querySelector('#calendar-days .calendar-day.selected');
            let dateText = '-';
            if (dateSelected) {
                const day = dateSelected.textContent;
                const monthNames = ["January", "February", "March", "April", "May", "June", 
                                  "July", "August", "September", "October", "November", "December"];
                dateText = `${day} ${monthNames[currentMonth]} ${currentYear}`;
            }
            
            // Get selected time
            const timeSelected = document.querySelector('.time-slot.selected');
            const timeText = timeSelected ? timeSelected.dataset.time : '-';
            
            // Calculate total
            let total = 0;
            if (bedrooms !== '-' && bathrooms !== '-') {
                // Base price
                total = 50 + (parseInt(bedrooms) * 15) + (parseInt(bathrooms) * 20);
                
                // Add extras
                total += extrasCost;
                
                // Adjust for frequency
                if (frequencyOption) {
                    switch(frequencyOption.dataset.frequency) {
                        case 'more-than-weekly': total *= 0.9; break; // 10% discount
                        case 'weekly': total *= 0.95; break; // 5% discount
                        case 'biweekly': break; // no discount
                        case 'one-off': total *= 1.1; break; // 10% premium
                    }
                }
            }
            
            // Update dropdown summary
            document.getElementById('dropdown-summary-bedrooms').textContent = bedrooms;
            document.getElementById('dropdown-summary-bathrooms').textContent = bathrooms;
            document.getElementById('dropdown-summary-extras').textContent = extrasText;
            document.getElementById('dropdown-summary-hours').textContent = workHours;
            document.getElementById('dropdown-summary-frequency').textContent = frequency;
            document.getElementById('dropdown-summary-date').textContent = dateText;
            document.getElementById('dropdown-summary-total').textContent = `£${total.toFixed(2)}`;
            
            // Update total amount in header
            document.getElementById('summary-total-amount').textContent = `£${total.toFixed(2)}`;
        }
        
        function updateFullSummary() {
            // Get all values for the full summary
            const bedrooms = document.getElementById('bedrooms').value || '-';
            const bathrooms = document.getElementById('bathrooms').value || '-';
            
            // Get selected extras
            updateSelectedExtras();
            const extrasText = selectedExtras.length > 0 ? 
                selectedExtras.map(e => e.name).join(', ') : 'None';
            
            // Get work hours
            const workHoursOption = document.querySelector('.option-block[data-hours].selected');
            const workHours = workHoursOption ? workHoursOption.dataset.hours + ' hours' : '-';
            
            // Get frequency
            const frequencyOption = document.querySelector('.option-block[data-frequency].selected');
            let frequency = '-';
            if (frequencyOption) {
                switch(frequencyOption.dataset.frequency) {
                    case 'more-than-weekly': frequency = 'More than weekly'; break;
                    case 'weekly': frequency = 'Every week'; break;
                    case 'biweekly': frequency = 'Every 2 weeks'; break;
                    case 'one-off': frequency = 'One-off'; break;
                }
            }
            
            // Get selected date
            const dateSelected = document.querySelector('#calendar-days .calendar-day.selected');
            let dateText = '-';
            if (dateSelected) {
                const day = dateSelected.textContent;
                const monthNames = ["January", "February", "March", "April", "May", "June", 
                                  "July", "August", "September", "October", "November", "December"];
                dateText = `${day} ${monthNames[currentMonth]} ${currentYear}`;
            }
            
            // Get selected time
            const timeSelected = document.querySelector('.time-slot.selected');
            const timeText = timeSelected ? timeSelected.dataset.time : '-';
            
            // Calculate total
            let total = 0;
            if (bedrooms !== '-' && bathrooms !== '-') {
                // Base price
                total = 50 + (parseInt(bedrooms) * 15) + (parseInt(bathrooms) * 20);
                
                // Add extras
                total += selectedExtras.reduce((sum, extra) => sum + extra.cost, 0);
                
                // Adjust for frequency
                if (frequencyOption) {
                    switch(frequencyOption.dataset.frequency) {
                        case 'more-than-weekly': total *= 0.9; break; // 10% discount
                        case 'weekly': total *= 0.95; break; // 5% discount
                        case 'biweekly': break; // no discount
                        case 'one-off': total *= 1.1; break; // 10% premium
                    }
                }
            }
            
            // Update full summary
            document.getElementById('full-summary-bedrooms').textContent = bedrooms;
            document.getElementById('full-summary-bathrooms').textContent = bathrooms;
            document.getElementById('full-summary-extras').textContent = extrasText;
            document.getElementById('full-summary-hours').textContent = workHours;
            document.getElementById('full-summary-frequency').textContent = frequency;
            document.getElementById('full-summary-date').textContent = dateText;
            document.getElementById('full-summary-time').textContent = timeText;
            document.getElementById('full-summary-total').textContent = `£${total.toFixed(2)}`;
        }
        
        // File upload handling
        function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            const previewContainer = document.getElementById('file-preview-container');
            
            files.slice(0, 5).forEach(file => {
                if (uploadedFiles.length >= 5) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const fileType = file.type.split('/')[0];
                    const preview = document.createElement('div');
                    preview.className = 'file-preview';
                    
                    if (fileType === 'image') {
                        preview.innerHTML = `
                            <img src="${e.target.result}" alt="${file.name}">
                            <div class="remove-file" onclick="removeFile('${file.name}')">&times;</div>
                        `;
                    } else if (fileType === 'video') {
                        preview.innerHTML = `
                            <video controls>
                                <source src="${e.target.result}" type="${file.type}">
                            </video>
                            <div class="remove-file" onclick="removeFile('${file.name}')">&times;</div>
                        `;
                    }
                    
                    previewContainer.appendChild(preview);
                    uploadedFiles.push({
                        name: file.name,
                        type: file.type,
                        data: e.target.result
                    });
                };
                reader.readAsDataURL(file);
            });
        }

        function removeFile(fileName) {
            uploadedFiles = uploadedFiles.filter(file => file.name !== fileName);
            const previews = Array.from(document.getElementsByClassName('file-preview'));
            previews.forEach(preview => {
                if ((preview.querySelector('img') && preview.querySelector('img').alt === fileName) || 
                    (preview.querySelector('source') && preview.querySelector('source').src.includes(fileName))) {
                    preview.remove();
                }
            });
        }
        
        async function processPayment() {
            if (!validateStep(4)) return;
            
            // Collect all form data in the specified format
            const dateSelected = document.querySelector('#calendar-days .calendar-day.selected');
            const timeSelected = document.querySelector('.time-slot.selected');
            
            const formData = {
                "email": document.getElementById('email').value,
                "name": document.getElementById('full-name').value,
                "bedrooms": parseInt(document.getElementById('bedrooms').value) || 0,
                "bathrooms": parseInt(document.getElementById('bathrooms').value) || 0,
                "extraTasks": selectedExtras.map(e => e.name),
                "cleaningProducts": document.querySelector('.option-block[data-products].selected')?.dataset.products === 'bring' ? 'We bring' : 'I provide',
                "frequency": document.querySelector('.option-block[data-frequency].selected')?.dataset.frequency,
                "firstClean": {
                    "time": timeSelected ? timeSelected.dataset.time : '',
                    "date": dateSelected ? `${dateSelected.textContent} ${currentMonth + 1} ${currentYear}` : ''
                },
                "address": {
                    "city": document.getElementById('city').value,
                    "state": '', // You might need to add a state field if needed
                    "zipCode": document.getElementById('postal-code').value
                },
                "price": document.getElementById('summary-total-amount').textContent.replace('£', '')
            };
            
            // Show loading state
            const payButton = document.getElementById('pay-now-button');
            payButton.disabled = true;
            payButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            
            try {
                // First submit to database
                const dbResponse = await fetch('http://localhost:3000/api/bookings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const dbData = await dbResponse.json();
                
                if (!dbResponse.ok) {
                    throw new Error(dbData.message || 'Failed to save booking');
                }
                
                // Then create Stripe checkout session
                const stripeResponse = await fetch('/api/create-stripe-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        amount: parseFloat(formData.price) * 100, // Convert to cents
                        currency: 'GBP',
                        customerEmail: formData.email,
                        metadata: {
                            booking_id: dbData.bookingId,
                            customer_name: formData.name
                        },
                        success_url: `${window.location.origin}/booking-success?session_id={CHECKOUT_SESSION_ID}`,
                        cancel_url: `${window.location.origin}/booking-canceled`
                    })
                });
                
                const stripeData = await stripeResponse.json();
                
                if (!stripeResponse.ok) {
                    throw new Error(stripeData.message || 'Failed to create payment session');
                }
                
                // Redirect to Stripe Checkout
                window.location.href = stripeData.url;
                
            } catch (error) {
                console.error('Payment processing error:', error);
                alert('There was an error processing your payment. Please try again.');
                payButton.disabled = false;
                payButton.textContent = 'Pay Now';
            }
        }
    </script>
</body>
</html>