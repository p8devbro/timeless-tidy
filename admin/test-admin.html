<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Cleaning Service</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary-color: #4a6fa5;
        --secondary-color: #166088;
        --accent-color: #4fc3f7;
        --light-gray: #f5f5f5;
        --dark-gray: #333;
        --white: #ffffff;
        --success-color: #4caf50;
        --warning-color: #ff9800;
        --danger-color: #f44336;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: #f0f2f5;
        color: var(--dark-gray);
        line-height: 1.6;
        display: flex;
        min-height: 100vh;
      }

      /* Sidebar Styles */
      .sidebar {
        width: 250px;
        background-color: var(--secondary-color);
        color: white;
        height: 100vh;
        position: fixed;
        padding: 20px 0;
        transition: all 0.3s;
      }

      .sidebar-header {
        padding: 0 20px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .sidebar-header h3 {
        color: white;
        display: flex;
        align-items: center;
      }

      .sidebar-header h3 i {
        margin-right: 10px;
      }

      .sidebar-menu {
        padding: 20px 0;
      }

      .menu-item {
        padding: 12px 20px;
        display: flex;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s;
      }

      .menu-item:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .menu-item.active {
        background-color: var(--primary-color);
      }

      .menu-item i {
        margin-right: 10px;
        width: 20px;
        text-align: center;
      }

      /* Main Content Styles */
      .main-content {
        flex: 1;
        margin-left: 250px;
        transition: all 0.3s;
      }

      .top-nav {
        background-color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .search-bar {
        display: flex;
        align-items: center;
      }

      .search-bar input {
        padding: 8px 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        width: 300px;
      }

      .search-bar i {
        margin-left: -30px;
        color: #777;
      }

      .user-info {
        display: flex;
        align-items: center;
      }

      .user-info img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
      }

      .content-area {
        padding: 20px;
      }

      .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 30px;
      }

      @media (max-width: 1200px) {
        .dashboard-cards {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 768px) {
        .dashboard-cards {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background-color: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .card-title {
        font-size: 16px;
        color: #666;
      }

      .card-value {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .card-change {
        font-size: 14px;
        display: flex;
        align-items: center;
      }

      .card-change.positive {
        color: var(--success-color);
      }

      .card-change.negative {
        color: var(--danger-color);
      }

      .card-icon {
        width: 50px;
        height: 50px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
      }

      .card-1 .card-icon {
        background-color: #4caf50;
      }

      .card-2 .card-icon {
        background-color: #2196f3;
      }

      .card-3 .card-icon {
        background-color: #ff9800;
      }

      .card-4 .card-icon {
        background-color: #9c27b0;
      }

      /* Table Styles */
      .table-container {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      th {
        background-color: #f9f9f9;
        font-weight: 600;
        color: #555;
      }

      tr:hover {
        background-color: #f5f5f5;
      }

      .status {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }

      .status-pending {
        background-color: #fff3cd;
        color: #856404;
      }

      .status-confirmed {
        background-color: #d4edda;
        color: #155724;
      }

      .status-completed {
        background-color: #d1ecf1;
        color: #0c5460;
      }

      .status-cancelled {
        background-color: #f8d7da;
        color: #721c24;
      }

      .status-assigned {
        color: var(--success-color);
        font-weight: 500;
      }

      .status-not-assigned {
        color: var(--warning-color);
        font-weight: 500;
      }

      .action-btn {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        margin-right: 5px;
      }

      .btn-primary {
        background-color: var(--primary-color);
        color: white;
      }

      .btn-success {
        background-color: var(--success-color);
        color: white;
      }

      .btn-danger {
        background-color: var(--danger-color);
        color: white;
      }

      .btn-warning {
        background-color: var(--warning-color);
        color: white;
      }

      /* Chart Container */
      .chart-container {
        background-color: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .chart-title {
        font-size: 18px;
        font-weight: 600;
      }

      /* Form Styles */
      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .form-row {
        display: flex;
        gap: 20px;
      }

      .form-row .form-group {
        flex: 1;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background-color: white;
        border-radius: 8px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        padding: 20px;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .modal-title {
        font-size: 20px;
        font-weight: 600;
      }

      .close-modal {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
      }

      .media-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 10px;
        margin-top: 15px;
      }

      .media-item {
        position: relative;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        height: 150px;
      }

      .media-item img,
      .media-item video {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .staff-tab {
        display: none;
      }

      .staff-tab.active {
        display: block;
      }

      .staff-assignment {
        width: 200px;
        margin-right: 10px;
      }

      .worker-email {
        color: #666;
        font-size: 0.9em;
        display: block;
        margin-top: 3px;
      }

      .status-cell {
        min-width: 160px;
      }

      /* Status message styling */
      .status-message {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 12px 24px;
        background: var(--success-color);
        color: white;
        border-radius: 4px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
        }
        to {
          transform: translateX(0);
        }
      }

      .active-tab {
        background-color: var(--primary-color) !important;
        color: white !important;
      }

      .tab-nav {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .tab-nav button {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        background-color: #f0f0f0;
        transition: all 0.3s;
      }

      .tab-nav button:hover {
        background-color: #e0e0e0;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .sidebar {
          width: 70px;
          overflow: hidden;
        }

        .sidebar-header h3 span,
        .menu-item span {
          display: none;
        }

        .menu-item {
          justify-content: center;
        }

        .menu-item i {
          margin-right: 0;
        }

        .main-content {
          margin-left: 70px;
        }

        .search-bar input {
          width: 150px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h3><i class="fas fa-broom"></i> <span>CleanPro Admin</span></h3>
      </div>
      <div class="sidebar-menu">
        <div class="menu-item active" data-section="dashboard">
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </div>
        <div class="menu-item" data-section="bookings">
          <i class="fas fa-calendar-alt"></i>
          <span>Bookings</span>
        </div>
        <div class="menu-item" data-section="completed-jobs">
          <i class="fas fa-check-circle"></i>
          <span>Completed Jobs</span>
        </div>
        <div class="menu-item" data-section="customers">
          <i class="fas fa-users"></i>
          <span>Customers</span>
        </div>
        <div class="menu-item" data-section="services">
          <i class="fas fa-concierge-bell"></i>
          <span>Services</span>
        </div>
        <div class="menu-item" data-section="staff">
          <i class="fas fa-user-tie"></i>
          <span>Staff</span>
        </div>
        <div class="menu-item" data-section="reports">
          <i class="fas fa-chart-bar"></i>
          <span>Reports</span>
        </div>
        <div class="menu-item" data-section="settings">
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Top Navigation -->
      <div class="top-nav">
        <div class="search-bar">
          <input type="text" placeholder="Search..." />
          <i class="fas fa-search"></i>
        </div>
        <div class="user-info">
          <img
            src="https://randomuser.me/api/portraits/men/41.jpg"
            alt="Admin User"
          />
          <span>Admin User</span>
          <button
            id="logout-btn"
            style="
              margin-left: 15px;
              background: none;
              border: none;
              color: var(--primary-color);
              cursor: pointer;
            "
          >
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </div>

      <!-- Content Area -->
      <div class="content-area">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section-content">
          <h2>Dashboard Overview</h2>

          <!-- Dashboard Cards -->
          <div class="dashboard-cards">
            <div class="card card-1">
              <div class="card-header">
                <div>
                  <div class="card-title">Total Bookings</div>
                  <div class="card-value" id="total-bookings">0</div>
                  <div class="card-change positive">
                    <i class="fas fa-arrow-up"></i>
                    <span id="booking-change">0%</span> from last month
                  </div>
                </div>
                <div class="card-icon">
                  <i class="fas fa-calendar-check"></i>
                </div>
              </div>
            </div>

            <div class="card card-2">
              <div class="card-header">
                <div>
                  <div class="card-title">Revenue</div>
                  <div class="card-value" id="total-revenue">£0</div>
                  <div class="card-change positive">
                    <i class="fas fa-arrow-up"></i>
                    <span id="revenue-change">0%</span> from last month
                  </div>
                </div>
                <div class="card-icon">
                  <i class="fas fa-pound-sign"></i>
                </div>
              </div>
            </div>

            <div class="card card-3">
              <div class="card-header">
                <div>
                  <div class="card-title">Active Customers</div>
                  <div class="card-value" id="total-customers">0</div>
                  <div class="card-change positive">
                    <i class="fas fa-arrow-up"></i>
                    <span id="customer-change">0%</span> from last month
                  </div>
                </div>
                <div class="card-icon">
                  <i class="fas fa-users"></i>
                </div>
              </div>
            </div>

            <div class="card card-4">
              <div class="card-header">
                <div>
                  <div class="card-title">Pending Bookings</div>
                  <div class="card-value" id="pending-bookings">0</div>
                  <div class="card-change negative">
                    <i class="fas fa-arrow-down"></i>
                    <span id="pending-change">0%</span> from last month
                  </div>
                </div>
                <div class="card-icon">
                  <i class="fas fa-clock"></i>
                </div>
              </div>
            </div>
          </div>

          <!-- Charts -->
          <div class="chart-container">
            <div class="chart-header">
              <div class="chart-title">Monthly Bookings</div>
              <select id="booking-period">
                <option value="6">Last 6 Months</option>
                <option value="12">Last 12 Months</option>
                <option value="24">Last 2 Years</option>
              </select>
            </div>
            <canvas id="bookings-chart" style="height: 300px"></canvas>
          </div>

          <div class="chart-container">
            <div class="chart-header">
              <div class="chart-title">Revenue by Service</div>
              <select id="revenue-period">
                <option value="1">Last Month</option>
                <option value="3">Last 3 Months</option>
                <option value="6">Last 6 Months</option>
              </select>
            </div>
            <canvas id="revenue-chart" style="height: 300px"></canvas>
          </div>

          <!-- Recent Bookings Table -->
          <div class="table-container">
            <div
              class="table-header"
              style="
                padding: 15px;
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <h3>Recent Bookings</h3>
              <button
                class="action-btn btn-primary"
                onclick="loadAllBookings()"
              >
                View All
              </button>
            </div>
            <table id="recent-bookings-table">
              <thead>
                <tr>
                  <th>Booking ID</th>
                  <th>Customer</th>
                  <th>Service</th>
                  <th>Date & Time</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Bookings Section -->
        <div
          id="bookings-section"
          class="section-content"
          style="display: none"
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
            "
          >
            <h2>Manage Bookings</h2>
            <button class="action-btn btn-primary" id="add-booking-btn">
              Add New Booking
            </button>
          </div>

          <div
            style="
              background: white;
              padding: 15px;
              border-radius: 8px;
              margin-bottom: 20px;
              display: flex;
              gap: 15px;
              flex-wrap: wrap;
            "
          >
            <div style="flex: 1; min-width: 200px">
              <label
                style="display: block; margin-bottom: 5px; font-weight: 600"
                >Status</label
              >
              <select
                id="booking-status-filter"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                "
              >
                <option value="all">All Statuses</option>
                <option value="pending">Pending</option>
                <option value="confirmed">Confirmed</option>
                <option value="completed">Completed</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
            <div style="flex: 1; min-width: 200px">
              <label
                style="display: block; margin-bottom: 5px; font-weight: 600"
                >Date Range</label
              >
              <select
                id="booking-date-filter"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                "
              >
                <option value="all">All Dates</option>
                <option value="today">Today</option>
                <option value="week">This Week</option>
                <option value="month">This Month</option>
                <option value="custom">Custom Range</option>
              </select>
            </div>
            <div style="flex: 1; min-width: 200px">
              <label
                style="display: block; margin-bottom: 5px; font-weight: 600"
                >Service Type</label
              >
              <select
                id="booking-service-filter"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                "
              >
                <option value="all">All Services</option>
                <!-- Will be populated by JavaScript -->
              </select>
            </div>
            <div
              style="
                flex: 1;
                min-width: 200px;
                display: flex;
                align-items: flex-end;
              "
            >
              <button
                class="action-btn btn-primary"
                style="width: 100%"
                onclick="filterBookings()"
              >
                Filter
              </button>
            </div>
          </div>

          <div class="table-container">
            <table id="bookings-table">
              <thead>
                <tr>
                  <th>Booking ID</th>
                  <th>Customer</th>
                  <th>Service</th>
                  <th>Date & Time</th>
                  <th>Amount</th>
                  <th>Assigned Cleaner</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>

          <div
            style="
              padding: 15px;
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <div id="bookings-pagination-info">Showing 0 to 0 of 0 entries</div>
            <div style="display: flex; gap: 5px">
              <button class="action-btn" id="bookings-prev-btn" disabled>
                Previous
              </button>
              <div id="bookings-pagination-numbers"></div>
              <button class="action-btn" id="bookings-next-btn" disabled>
                Next
              </button>
            </div>
          </div>
        </div>

        <!-- Completed Jobs Section -->
        <div
          id="completed-jobs-section"
          class="section-content"
          style="display: none"
        >
          <h2>Completed Jobs</h2>

          <div
            style="
              background: white;
              padding: 15px;
              border-radius: 8px;
              margin-bottom: 20px;
              display: flex;
              gap: 15px;
              flex-wrap: wrap;
            "
          >
            <div style="flex: 1; min-width: 200px">
              <label
                style="display: block; margin-bottom: 5px; font-weight: 600"
                >Status</label
              >
              <select
                id="job-status-filter"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                "
              >
                <option value="all">All Statuses</option>
                <option value="pending_review">Pending Review</option>
                <option value="approved">Approved</option>
                <option value="rejected">Rejected</option>
              </select>
            </div>
            <div style="flex: 1; min-width: 200px">
              <label
                style="display: block; margin-bottom: 5px; font-weight: 600"
                >Date Range</label
              >
              <select
                id="job-date-filter"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                "
              >
                <option value="all">All Dates</option>
                <option value="today">Today</option>
                <option value="week">This Week</option>
                <option value="month">This Month</option>
              </select>
            </div>
            <div
              style="
                flex: 1;
                min-width: 200px;
                display: flex;
                align-items: flex-end;
              "
            >
              <button
                class="action-btn btn-primary"
                style="width: 100%"
                onclick="filterCompletedJobs()"
              >
                Filter
              </button>
            </div>
          </div>

          <div class="table-container">
            <table id="completed-jobs-table">
              <thead>
                <tr>
                  <th>Job ID</th>
                  <th>Booking ID</th>
                  <th>Cleaner</th>
                  <th>Completed Date</th>
                  <th>Status</th>
                  <th>Media</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>

          <div
            style="
              padding: 15px;
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <div id="jobs-pagination-info">Showing 0 to 0 of 0 entries</div>
            <div style="display: flex; gap: 5px">
              <button class="action-btn" id="jobs-prev-btn" disabled>
                Previous
              </button>
              <div id="jobs-pagination-numbers"></div>
              <button class="action-btn" id="jobs-next-btn" disabled>
                Next
              </button>
            </div>
          </div>
        </div>

        <!-- Customers Section -->
        <div
          id="customers-section"
          class="section-content"
          style="display: none"
        >
          <h2>Customer Management</h2>
          <div class="table-container">
            <table id="customers-table">
              <thead>
                <tr>
                  <th>Customer ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Bookings</th>
                  <th>Last Booking</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Services Section -->
        <div
          id="services-section"
          class="section-content"
          style="display: none"
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
            "
          >
            <h2>Service Configuration</h2>
            <button class="action-btn btn-primary" id="add-service-btn">
              Add New Service
            </button>
          </div>

          <div class="table-container">
            <table id="services-table">
              <thead>
                <tr>
                  <th>Service</th>
                  <th>Base Price</th>
                  <th>Bedroom No</th>
                  <th>Bathroom No</th>
                  <th>Extra Tasks</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Staff Section -->
        <div id="staff-section" class="section-content" style="display: none">
          <h2>Staff Management</h2>
          <div class="tab-nav">
            <button
              class="action-btn btn-primary active-tab"
              data-tab="applicants"
            >
              Applicants
            </button>
            <button class="action-btn btn-primary" data-tab="workers">
              View Workers
            </button>
          </div>

          <!-- Applicants Tab -->
          <div id="applicants-tab" class="staff-tab active">
            <div class="table-container">
              <table id="applicants-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <!-- <th>Phone</th> -->
                    <th>Applied Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Workers Tab -->
          <div id="workers-tab" class="staff-tab">
            <div class="table-container">
              <table id="workers-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Join Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Reports Section -->
        <div id="reports-section" class="section-content" style="display: none">
          <h2>Reports & Analytics</h2>
          <div class="chart-container">
            <div class="chart-header">
              <div class="chart-title">Customer Satisfaction</div>
              <select id="satisfaction-period">
                <option value="3">Last 3 Months</option>
                <option value="6">Last 6 Months</option>
                <option value="12">Last 12 Months</option>
              </select>
            </div>
            <canvas id="satisfaction-chart" style="height: 300px"></canvas>
          </div>

          <div class="table-container">
            <div
              class="table-header"
              style="
                padding: 15px;
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <h3>Customer Complaints</h3>
              <button class="action-btn btn-primary">View All</button>
            </div>
            <table id="complaints-table">
              <thead>
                <tr>
                  <th>Complaint ID</th>
                  <th>Client</th>
                  <th>Complaint</th>
                  <th>Date</th>
                  <th>Assigned To</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Settings Section -->
        <div
          id="settings-section"
          class="section-content"
          style="display: none"
        >
          <h2>Account Settings</h2>
          <div class="card" style="max-width: 500px; margin: 0 auto">
            <form id="password-form">
              <div class="form-group">
                <label>Current Password</label>
                <input type="password" id="current-password" required />
              </div>
              <div class="form-group">
                <label>New Password</label>
                <input type="password" id="new-password" required />
              </div>
              <div class="form-group">
                <label>Confirm New Password</label>
                <input type="password" id="confirm-password" required />
              </div>
              <div style="margin-top: 20px">
                <button type="submit" class="action-btn btn-primary">
                  Change Password
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- View Applications Modal -->
    <div class="modal" id="applications-modal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">
            Applications for Booking <span id="booking-id-title"></span>
          </div>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="table-container">
            <table id="applications-table">
              <thead>
                <tr>
                  <th>Cleaner</th>
                  <th>Email</th>
                  <th>Rating</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
          <div class="form-group" style="margin-top: 20px">
            <label>Assign Cleaner:</label>
            <select id="assign-cleaner-select" class="staff-assignment">
              <!-- Will be populated by JavaScript -->
            </select>
            <button
              class="action-btn btn-primary"
              id="confirm-assignment-btn"
              style="margin-top: 10px"
            >
              Assign Cleaner
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- View Job Details Modal -->
    <div class="modal" id="job-details-modal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">
            Job Details <span id="job-id-title"></span>
          </div>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Cleaner:</label>
            <p id="job-cleaner-name"></p>
          </div>
          <div class="form-group">
            <label>Completion Date:</label>
            <p id="job-completion-date"></p>
          </div>
          <div class="form-group">
            <label>Notes:</label>
            <p id="job-notes"></p>
          </div>
          <div class="form-group">
            <label>Media:</label>
            <div class="media-gallery" id="job-media-gallery">
              <!-- Will be populated by JavaScript -->
            </div>
          </div>
          <div class="form-group" style="margin-top: 20px">
            <label>Status:</label>
            <select id="job-status-select">
              <option value="pending_review">Pending Review</option>
              <option value="approved">Approved</option>
              <option value="rejected">Rejected</option>
            </select>
            <button
              class="action-btn btn-primary"
              id="update-job-status-btn"
              style="margin-top: 10px"
            >
              Update Status
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Booking Modal -->
    <div class="modal" id="add-booking-modal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">Add New Booking</div>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="add-booking-form">
            <div class="form-group">
              <label>Customer</label>
              <select id="booking-customer" required>
                <!-- Will be populated by JavaScript -->
              </select>
            </div>
            <div class="form-group">
              <label>Service</label>
              <select id="booking-service" required>
                <!-- Will be populated by JavaScript -->
              </select>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Bedrooms</label>
                <input
                  type="number"
                  id="booking-bedrooms"
                  min="1"
                  value="1"
                  required
                />
              </div>
              <div class="form-group">
                <label>Bathrooms</label>
                <input
                  type="number"
                  id="booking-bathrooms"
                  min="1"
                  value="1"
                  required
                />
              </div>
            </div>
            <div class="form-group">
              <label>Extras</label>
              <div id="booking-extras-container">
                <!-- Will be populated by JavaScript -->
              </div>
            </div>
            <div class="form-group">
              <label>Date</label>
              <input type="date" id="booking-date" required />
            </div>
            <div class="form-group">
              <label>Time</label>
              <input type="time" id="booking-time" required />
            </div>
            <div class="form-group">
              <label>Special Instructions</label>
              <textarea id="booking-notes" rows="3"></textarea>
            </div>
            <div
              style="
                display: flex;
                justify-content: flex-end;
                gap: 10px;
                margin-top: 20px;
              "
            >
              <button type="button" class="action-btn close-modal">
                Cancel
              </button>
              <button type="submit" class="action-btn btn-primary">
                Create Booking
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add Service Modal -->
    <div class="modal" id="add-service-modal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">Add New Service</div>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="add-service-form">
            <div class="form-group">
              <label>Service Name</label>
              <input
                type="text"
                id="service-name"
                placeholder="Enter service name"
                required
              />
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Base Price (£)</label>
                <input
                  type="number"
                  id="service-base-price"
                  min="0"
                  step="0.01"
                  placeholder="0.00"
                  required
                />
              </div>
              <div class="form-group">
                <label>Bedroom Rate (£)</label>
                <input
                  type="number"
                  id="service-bedroom-rate"
                  min="0"
                  step="0.01"
                  placeholder="0.00"
                  required
                />
              </div>
              <div class="form-group">
                <label>Bathroom Rate (£)</label>
                <input
                  type="number"
                  id="service-bathroom-rate"
                  min="0"
                  step="0.01"
                  placeholder="0.00"
                  required
                />
              </div>
            </div>

            <div class="form-group">
              <label>Description</label>
              <textarea
                id="service-description"
                rows="3"
                placeholder="Enter service description"
              ></textarea>
            </div>

            <div class="form-group">
              <label>Extra Services</label>
              <div id="extra-services-container">
                <!-- Existing extras would be listed here -->
              </div>
              <button
                type="button"
                class="action-btn"
                style="margin-top: 10px"
                id="add-extra-btn"
              >
                Add Extra Service
              </button>
            </div>

            <div
              style="
                display: flex;
                justify-content: flex-end;
                gap: 10px;
                margin-top: 20px;
              "
            >
              <button type="button" class="action-btn close-modal">
                Cancel
              </button>
              <button type="submit" class="action-btn btn-primary">
                Save Service
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add Extra Service Modal -->
    <div class="modal" id="add-extra-modal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">Add Extra Service</div>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="add-extra-form">
            <div class="form-group">
              <label>Extra Service Name</label>
              <input
                type="text"
                id="extra-name"
                placeholder="Enter extra service name"
                required
              />
            </div>
            <div class="form-group">
              <label>Price (£)</label>
              <input
                type="number"
                id="extra-price"
                min="0"
                step="0.01"
                placeholder="0.00"
                required
              />
            </div>
            <div class="form-group">
              <label>Description</label>
              <textarea
                id="extra-description"
                rows="3"
                placeholder="Enter extra service description"
              ></textarea>
            </div>
            <div
              style="
                display: flex;
                justify-content: flex-end;
                gap: 10px;
                margin-top: 20px;
              "
            >
              <button type="button" class="action-btn close-modal">
                Cancel
              </button>
              <button type="submit" class="action-btn btn-primary">
                Add Extra
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Global variables
      let currentUser = null;
      let bookingsData = [];
      let completedJobsData = [];
      let customersData = [];
      let servicesData = [];
      let staffData = [];
      let applicantsData = [];
      let currentBookingId = null;
      let currentJobId = null;
      let bookingsCurrentPage = 1;
      let jobsCurrentPage = 1;
      const bookingsPerPage = 10;
      const jobsPerPage = 10;

      // API Routes
      const API_BASE = "http://localhost:3000/api/admin";
      const API_ROUTES = {
        login: "/client/admin/login",
        logout: "/client/admin/logout",
        dashboard: "/dashboard",
        bookings: "//services",
        bookingsApplications: "/services/applications",
        bookingsAssign: (id, workerId) =>
          `/services/${id}/applications/${workerId}/review`,
        completedJobs: "/completed-jobs",
        completedJobsUpdate: "/completed-jobs/update",
        customers: "/customers",
        services: "/services/applications",
        staff: "/staff",
        applicants: "/workers/applications",
        reviewApplicant: (id) => `/workers/applications/${id}/review`,

        changePassword: "/change-password",
      };

      // Update the DOMContentLoaded event listener
      document.addEventListener("DOMContentLoaded", async () => {
        // Check if user is authenticated
        const token = localStorage.getItem("adminToken");
        if (!token && !window.location.href.includes("/login")) {
          window.location.href = "/admin/login.html";
          return;
        }

        try {
          // Initialize the dashboard even if we can't load data
          initializeDashboard();

          // Load user data if token exists
          if (token) {
            await loadUserData();
            await loadDashboardData();
          }
        } catch (error) {
          console.error("Failed to initialize dashboard:", error);
          // Still show the dashboard even if data fails to load
          initializeDashboard();
        }

        // Add this new function
        function initializeDashboard() {
          // Set up all event listeners
          setupEventListeners();

          loadApplicants();

          loadServices();

          // Show dashboard section by default
          document.getElementById("dashboard-section").style.display = "block";

          // Initialize charts with empty data
          initCharts();
        }
      });

      // Load user data
      async function loadUserData() {
        try {
          const response = await fetch(`${API_BASE}${API_ROUTES.dashboard}`, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to load user data");
          }

          const data = await response.json();
          currentUser = data.user;

          // Update UI with user data
          document.querySelector(".user-info span").textContent =
            currentUser.name;
          if (currentUser.avatar) {
            document.querySelector(".user-info img").src = currentUser.avatar;
          }
        } catch (error) {
          console.error("Error loading user data:", error);
          throw error;
        }
      }

      // Load dashboard data
      async function loadDashboardData() {
        try {
          const response = await fetch(`${API_BASE}${API_ROUTES.dashboard}`, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to load dashboard data");
          }

          const data = await response.json();

          // Update dashboard cards
          document.getElementById("total-bookings").textContent =
            data.totalBookings;
          document.getElementById(
            "total-revenue"
          ).textContent = `£${data.totalRevenue.toFixed(2)}`;
          document.getElementById("total-customers").textContent =
            data.totalCustomers;
          document.getElementById("pending-bookings").textContent =
            data.pendingBookings;
          document.getElementById(
            "booking-change"
          ).textContent = `${data.bookingChange}%`;
          document.getElementById(
            "revenue-change"
          ).textContent = `${data.revenueChange}%`;
          document.getElementById(
            "customer-change"
          ).textContent = `${data.customerChange}%`;
          document.getElementById(
            "pending-change"
          ).textContent = `${data.pendingChange}%`;

          // Update recent bookings table
          updateRecentBookingsTable(data.recentBookings);

          return data;
        } catch (error) {
          console.error("Error loading dashboard data:", error);
          throw error;
        }
      }

      // Update recent bookings table
      function updateRecentBookingsTable(bookings) {
        const tableBody = document.querySelector(
          "#recent-bookings-table tbody"
        );
        tableBody.innerHTML = "";

        bookings.forEach((booking) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${booking.bookingId}</td>
                    <td>${booking.customerName}</td>
                    <td>${booking.serviceName}</td>
                    <td>${new Date(booking.dateTime).toLocaleString()}</td>
                    <td>£${booking.amount.toFixed(2)}</td>
                    <td><span class="status status-${booking.status.toLowerCase()}">${
            booking.status
          }</span></td>
                    <td>
                        <button class="action-btn btn-primary" onclick="viewBookingDetails('${
                          booking._id
                        }')"><i class="fas fa-eye"></i></button>
                        ${
                          booking.status === "Pending"
                            ? `
                            <button class="action-btn btn-success" onclick="confirmBooking('${booking._id}')"><i class="fas fa-check"></i></button>
                            <button class="action-btn btn-danger" onclick="cancelBooking('${booking._id}')"><i class="fas fa-times"></i></button>
                        `
                            : ""
                        }
                        ${
                          booking.status === "Completed"
                            ? `
                            <button class="action-btn btn-warning"><i class="fas fa-edit"></i></button>
                            <button class="action-btn btn-danger"><i class="fas fa-trash"></i></button>
                        `
                            : ""
                        }
                    </td>
                `;
          tableBody.appendChild(row);
        });
      }

      // Load all bookings
      async function loadBookings(page = 1) {
        try {
          const statusFilter = document.getElementById(
            "booking-status-filter"
          ).value;
          const dateFilter = document.getElementById(
            "booking-date-filter"
          ).value;
          const serviceFilter = document.getElementById(
            "booking-service-filter"
          ).value;

          let url = `${API_BASE}${API_ROUTES.bookings}?page=${page}&limit=${bookingsPerPage}`;

          if (statusFilter !== "all") {
            url += `&status=${statusFilter}`;
          }

          if (dateFilter !== "all") {
            url += `&dateRange=${dateFilter}`;
          }

          if (serviceFilter !== "all") {
            url += `&service=${serviceFilter}`;
          }

          const response = await fetch(url, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to load bookings");
          }

          const data = await response.json();
          bookingsData = data.bookings;

          // Update bookings table
          updateBookingsTable();

          // Update pagination
          updateBookingsPagination(data.total, page);

          return data;
        } catch (error) {
          console.error("Error loading bookings:", error);
          showStatusMessage("Failed to load bookings", "error");
          throw error;
        }
      }

      // Update bookings table
      function updateBookingsTable() {
        const tableBody = document.querySelector("#bookings-table tbody");
        tableBody.innerHTML = "";

        bookingsData.forEach((booking) => {
          const row = document.createElement("tr");
          row.dataset.bookingId = booking._id;

          row.innerHTML = `
                    <td>${booking.bookingId}</td>
                    <td>${booking.customerName}</td>
                    <td>${booking.serviceName}</td>
                    <td>${new Date(booking.dateTime).toLocaleString()}</td>
                    <td>£${booking.amount.toFixed(2)}</td>
                    <td class="status-cell">
                        ${
                          booking.assignedCleaner
                            ? `
                            <div class="status status-assigned">
                                Assigned
                                <span class="worker-email">${booking.assignedCleaner.email}</span>
                            </div>
                        `
                            : `
                            <span class="status status-not-assigned">Not Assigned</span>
                        `
                        }
                    </td>
                    <td><span class="status status-${booking.status.toLowerCase()}">${
            booking.status
          }</span></td>
                    <td>
                        <button class="action-btn btn-primary" onclick="viewBookingApplications('${
                          booking._id
                        }')">
                            ${booking.assignedCleaner ? "Reassign" : "Assign"}
                        </button>
                        <button class="action-btn btn-warning" onclick="editBooking('${
                          booking._id
                        }')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
          tableBody.appendChild(row);
        });
      }

      // Update bookings pagination
      function updateBookingsPagination(totalBookings, currentPage) {
        const totalPages = Math.ceil(totalBookings / bookingsPerPage);
        bookingsCurrentPage = currentPage;

        // Update pagination info
        const start = (currentPage - 1) * bookingsPerPage + 1;
        const end = Math.min(currentPage * bookingsPerPage, totalBookings);
        document.getElementById(
          "bookings-pagination-info"
        ).textContent = `Showing ${start} to ${end} of ${totalBookings} entries`;

        // Update pagination buttons
        document.getElementById("bookings-prev-btn").disabled =
          currentPage === 1;
        document.getElementById("bookings-next-btn").disabled =
          currentPage === totalPages;

        // Update page numbers
        const paginationNumbers = document.getElementById(
          "bookings-pagination-numbers"
        );
        paginationNumbers.innerHTML = "";

        const maxVisiblePages = 5;
        let startPage = Math.max(
          1,
          currentPage - Math.floor(maxVisiblePages / 2)
        );
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

        if (endPage - startPage + 1 < maxVisiblePages) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        if (startPage > 1) {
          const pageItem = document.createElement("button");
          pageItem.className = "action-btn";
          pageItem.textContent = "1";
          pageItem.onclick = () => loadBookings(1);
          paginationNumbers.appendChild(pageItem);

          if (startPage > 2) {
            const ellipsis = document.createElement("span");
            ellipsis.textContent = "...";
            ellipsis.style.padding = "6px 12px";
            paginationNumbers.appendChild(ellipsis);
          }
        }

        for (let i = startPage; i <= endPage; i++) {
          const pageItem = document.createElement("button");
          pageItem.className = `action-btn ${
            i === currentPage ? "btn-primary" : ""
          }`;
          pageItem.textContent = i;
          pageItem.onclick = () => loadBookings(i);
          paginationNumbers.appendChild(pageItem);
        }

        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            const ellipsis = document.createElement("span");
            ellipsis.textContent = "...";
            ellipsis.style.padding = "6px 12px";
            paginationNumbers.appendChild(ellipsis);
          }

          const pageItem = document.createElement("button");
          pageItem.className = "action-btn";
          pageItem.textContent = totalPages;
          pageItem.onclick = () => loadBookings(totalPages);
          paginationNumbers.appendChild(pageItem);
        }
      }

      // Filter bookings
      function filterBookings() {
        loadBookings(1);
      }

      // Load all bookings (for View All button)
      function loadAllBookings() {
        document.querySelector('.menu-item[data-section="bookings"]').click();
      }

      // View booking applications
      async function viewBookingApplications(bookingId) {
        try {
          currentBookingId = bookingId;

          // Load applications for this booking
          const response = await fetch(
            `${API_BASE}${API_ROUTES.bookingsApplications}/${bookingId}`,
            {
              headers: {
                Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
              },
            }
          );

          if (!response.ok) {
            throw new Error("Failed to load applications");
          }

          const data = await response.json();

          // Update modal title
          document.getElementById("booking-id-title").textContent =
            data.booking.bookingId;

          // Update applications table
          const tableBody = document.querySelector("#applications-table tbody");
          tableBody.innerHTML = "";

          data.applications.forEach((application) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                        <td>${application.cleaner.name}</td>
                        <td>${application.cleaner.email}</td>
                        <td>${application.cleaner.rating || "N/A"}</td>
                        <td><span class="status status-${application.status.toLowerCase()}">${
              application.status
            }</span></td>
                        <td>
                            <button class="action-btn btn-primary" onclick="assignCleaner('${
                              application.cleaner._id
                            }', '${application.cleaner.name}')">
                                Assign
                            </button>
                        </td>
                    `;
            tableBody.appendChild(row);
          });

          // Update assign cleaner dropdown
          const select = document.getElementById("assign-cleaner-select");
          select.innerHTML = "";

          data.availableCleaners.forEach((cleaner) => {
            const option = document.createElement("option");
            option.value = cleaner._id;
            option.textContent = `${cleaner.name} (${cleaner.email})`;
            select.appendChild(option);
          });

          // Show modal
          document.getElementById("applications-modal").style.display = "flex";
        } catch (error) {
          console.error("Error viewing booking applications:", error);
          showStatusMessage("Failed to load applications", "error");
        }
      }

      // Assign cleaner
      async function assignCleaner(cleanerId, cleanerName) {
        try {
          const response = await fetch(
            `${API_BASE}${API_ROUTES.bookingsAssign}/${currentBookingId}`,
            {
              method: "POST",
              headers: {
                Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ cleanerId }),
            }
          );

          if (!response.ok) {
            throw new Error("Failed to assign cleaner");
          }

          // Close modal
          document.getElementById("applications-modal").style.display = "none";

          // Update UI
          const row = document.querySelector(
            `tr[data-booking-id="${currentBookingId}"]`
          );
          if (row) {
            row.querySelector(".status-cell").innerHTML = `
                        <div class="status status-assigned">
                            Assigned
                            <span class="worker-email">${cleanerName}</span>
                        </div>
                    `;
            row.querySelector(".action-btn").textContent = "Reassign";
          }

          showStatusMessage("Cleaner assigned successfully!");
        } catch (error) {
          console.error("Error assigning cleaner:", error);
          showStatusMessage("Failed to assign cleaner", "error");
        }
      }

      // Confirm assignment from dropdown
      document
        .getElementById("confirm-assignment-btn")
        .addEventListener("click", async () => {
          const select = document.getElementById("assign-cleaner-select");
          const cleanerId = select.value;
          const cleanerName =
            select.options[select.selectedIndex].text.split(" (")[0];

          await assignCleaner(cleanerId, cleanerName);
        });

      // Load completed jobs
      async function loadCompletedJobs(page = 1) {
        try {
          const statusFilter =
            document.getElementById("job-status-filter").value;
          const dateFilter = document.getElementById("job-date-filter").value;

          let url = `${API_BASE}${API_ROUTES.completedJobs}?page=${page}&limit=${jobsPerPage}`;

          if (statusFilter !== "all") {
            url += `&status=${statusFilter}`;
          }

          if (dateFilter !== "all") {
            url += `&dateRange=${dateFilter}`;
          }

          const response = await fetch(url, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to load completed jobs");
          }

          const data = await response.json();
          completedJobsData = data.jobs;

          // Update completed jobs table
          updateCompletedJobsTable();

          // Update pagination
          updateJobsPagination(data.total, page);

          return data;
        } catch (error) {
          console.error("Error loading completed jobs:", error);
          showStatusMessage("Failed to load completed jobs", "error");
          throw error;
        }
      }

      // Update completed jobs table
      function updateCompletedJobsTable() {
        const tableBody = document.querySelector("#completed-jobs-table tbody");
        tableBody.innerHTML = "";

        completedJobsData.forEach((job) => {
          const row = document.createElement("tr");
          row.dataset.jobId = job._id;

          row.innerHTML = `
                    <td>${job.jobId}</td>
                    <td>${job.booking.bookingId}</td>
                    <td>${job.cleaner.name}</td>
                    <td>${new Date(job.completedAt).toLocaleDateString()}</td>
                    <td><span class="status status-${job.status
                      .toLowerCase()
                      .replace(" ", "_")}">${job.status.replace(
            "_",
            " "
          )}</span></td>
                    <td>
                        <button class="action-btn btn-primary" onclick="viewJobMedia('${
                          job._id
                        }')">
                            View (${job.media.length})
                        </button>
                    </td>
                    <td>
                        <button class="action-btn btn-primary" onclick="viewJobDetails('${
                          job._id
                        }')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
          tableBody.appendChild(row);
        });
      }

      // Update jobs pagination
      function updateJobsPagination(totalJobs, currentPage) {
        const totalPages = Math.ceil(totalJobs / jobsPerPage);
        jobsCurrentPage = currentPage;

        // Update pagination info
        const start = (currentPage - 1) * jobsPerPage + 1;
        const end = Math.min(currentPage * jobsPerPage, totalJobs);
        document.getElementById(
          "jobs-pagination-info"
        ).textContent = `Showing ${start} to ${end} of ${totalJobs} entries`;

        // Update pagination buttons
        document.getElementById("jobs-prev-btn").disabled = currentPage === 1;
        document.getElementById("jobs-next-btn").disabled =
          currentPage === totalPages;

        // Update page numbers
        const paginationNumbers = document.getElementById(
          "jobs-pagination-numbers"
        );
        paginationNumbers.innerHTML = "";

        const maxVisiblePages = 5;
        let startPage = Math.max(
          1,
          currentPage - Math.floor(maxVisiblePages / 2)
        );
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

        if (endPage - startPage + 1 < maxVisiblePages) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        if (startPage > 1) {
          const pageItem = document.createElement("button");
          pageItem.className = "action-btn";
          pageItem.textContent = "1";
          pageItem.onclick = () => loadCompletedJobs(1);
          paginationNumbers.appendChild(pageItem);

          if (startPage > 2) {
            const ellipsis = document.createElement("span");
            ellipsis.textContent = "...";
            ellipsis.style.padding = "6px 12px";
            paginationNumbers.appendChild(ellipsis);
          }
        }

        for (let i = startPage; i <= endPage; i++) {
          const pageItem = document.createElement("button");
          pageItem.className = `action-btn ${
            i === currentPage ? "btn-primary" : ""
          }`;
          pageItem.textContent = i;
          pageItem.onclick = () => loadCompletedJobs(i);
          paginationNumbers.appendChild(pageItem);
        }

        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            const ellipsis = document.createElement("span");
            ellipsis.textContent = "...";
            ellipsis.style.padding = "6px 12px";
            paginationNumbers.appendChild(ellipsis);
          }

          const pageItem = document.createElement("button");
          pageItem.className = "action-btn";
          pageItem.textContent = totalPages;
          pageItem.onclick = () => loadCompletedJobs(totalPages);
          paginationNumbers.appendChild(pageItem);
        }
      }

      // Filter completed jobs
      function filterCompletedJobs() {
        loadCompletedJobs(1);
      }

      // View job media
      function viewJobMedia(jobId) {
        const job = completedJobsData.find((j) => j._id === jobId);
        if (!job) return;

        const mediaGallery = document.getElementById("job-media-gallery");
        mediaGallery.innerHTML = "";

        job.media.forEach((mediaItem) => {
          const mediaElement = document.createElement("div");
          mediaElement.className = "media-item";

          if (mediaItem.type.startsWith("image/")) {
            mediaElement.innerHTML = `<img src="${mediaItem.url}" alt="Job media">`;
          } else if (mediaItem.type.startsWith("video/")) {
            mediaElement.innerHTML = `
                        <video controls>
                            <source src="${mediaItem.url}" type="${mediaItem.type}">
                            Your browser does not support the video tag.
                        </video>
                    `;
          }

          mediaGallery.appendChild(mediaElement);
        });

        // Show modal
        document.getElementById("job-details-modal").style.display = "flex";
      }

      // View job details
      async function viewJobDetails(jobId) {
        try {
          currentJobId = jobId;

          const job = completedJobsData.find((j) => j._id === jobId);
          if (!job) {
            throw new Error("Job not found");
          }

          // Update modal title
          document.getElementById("job-id-title").textContent = job.jobId;

          // Update job details
          document.getElementById("job-cleaner-name").textContent =
            job.cleaner.name;
          document.getElementById("job-completion-date").textContent = new Date(
            job.completedAt
          ).toLocaleString();
          document.getElementById("job-notes").textContent =
            job.notes || "No notes provided";

          // Update media gallery
          const mediaGallery = document.getElementById("job-media-gallery");
          mediaGallery.innerHTML = "";

          job.media.forEach((mediaItem) => {
            const mediaElement = document.createElement("div");
            mediaElement.className = "media-item";

            if (mediaItem.type.startsWith("image/")) {
              mediaElement.innerHTML = `<img src="${mediaItem.url}" alt="Job media">`;
            } else if (mediaItem.type.startsWith("video/")) {
              mediaElement.innerHTML = `
                            <video controls>
                                <source src="${mediaItem.url}" type="${mediaItem.type}">
                                Your browser does not support the video tag.
                            </video>
                        `;
            }

            mediaGallery.appendChild(mediaElement);
          });

          // Update status select
          const statusSelect = document.getElementById("job-status-select");
          statusSelect.value = job.status;

          // Show modal
          document.getElementById("job-details-modal").style.display = "flex";
        } catch (error) {
          console.error("Error viewing job details:", error);
          showStatusMessage("Failed to load job details", "error");
        }
      }

      // Update job status
      document
        .getElementById("update-job-status-btn")
        .addEventListener("click", async () => {
          try {
            const status = document.getElementById("job-status-select").value;

            const response = await fetch(
              `${API_BASE}${API_ROUTES.completedJobsUpdate}/${currentJobId}`,
              {
                method: "PUT",
                headers: {
                  Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ status }),
              }
            );

            if (!response.ok) {
              throw new Error("Failed to update job status");
            }

            // Close modal
            document.getElementById("job-details-modal").style.display = "none";

            // Update UI
            const row = document.querySelector(
              `tr[data-job-id="${currentJobId}"]`
            );
            if (row) {
              row.querySelector(
                ".status"
              ).className = `status status-${status.toLowerCase()}`;
              row.querySelector(".status").textContent = status.replace(
                "_",
                " "
              );
            }

            showStatusMessage("Job status updated successfully!");
          } catch (error) {
            console.error("Error updating job status:", error);
            showStatusMessage("Failed to update job status", "error");
          }
        });

      // Load customers
      async function loadCustomers() {
        try {
          const response = await fetch(`${API_BASE}${API_ROUTES.customers}`, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to load customers");
          }

          const data = await response.json();
          customersData = data.customers;

          // Update customers table
          updateCustomersTable();

          // Populate customer dropdown in add booking modal
          const customerSelect = document.getElementById("booking-customer");
          customerSelect.innerHTML = "";

          customersData.forEach((customer) => {
            const option = document.createElement("option");
            option.value = customer._id;
            option.textContent = `${customer.name} (${customer.email})`;
            customerSelect.appendChild(option);
          });

          return data;
        } catch (error) {
          console.error("Error loading customers:", error);
          showStatusMessage("Failed to load customers", "error");
          throw error;
        }
      }

      // Update customers table
      function updateCustomersTable() {
        const tableBody = document.querySelector("#customers-table tbody");
        tableBody.innerHTML = "";

        customersData.forEach((customer) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${customer.customerId}</td>
                    <td>${customer.name}</td>
                    <td>${customer.email}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.totalBookings}</td>
                    <td>${
                      customer.lastBooking
                        ? new Date(customer.lastBooking).toLocaleDateString()
                        : "N/A"
                    }</td>
                    <td>
                        <button class="action-btn btn-primary" onclick="viewCustomerDetails('${
                          customer._id
                        }')"><i class="fas fa-eye"></i></button>
                        <button class="action-btn btn-warning" onclick="editCustomer('${
                          customer._id
                        }')"><i class="fas fa-edit"></i></button>
                        <button class="action-btn btn-danger" onclick="deleteCustomer('${
                          customer._id
                        }')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
          tableBody.appendChild(row);
        });
      }

      // Load services
      async function loadServices() {
        try {
          const response = await fetch(`${API_BASE}${API_ROUTES.services}`, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to load services");
          }

          const { data } = await response.json();
          //   servicesData = data.services;

          // Update services table
          updateServicesTable(data);

          // Populate service dropdown in add booking modal
          const serviceSelect = document.getElementById("booking-service");
          serviceSelect.innerHTML = "";

          //   servicesData.forEach((service) => {
          //     const option = document.createElement("option");
          //     option.value = service._id;
          //     option.textContent = service.name;
          //     serviceSelect.appendChild(option);
          //   });

          // Populate service filter in bookings section
          //   const serviceFilter = document.getElementById(
          //     "booking-service-filter"
          //   );
          //   serviceFilter.innerHTML = '<option value="all">All Services</option>';

          //   servicesData.forEach((service) => {
          //     const option = document.createElement("option");
          //     option.value = service._id;
          //     option.textContent = service.name;
          //     serviceFilter.appendChild(option);
          //   });

          return data;
        } catch (error) {
          console.error("Error loading services:", error);
          showStatusMessage("Failed to load services", "error");
          throw error;
        }
      }

      // Update services table
      function updateServicesTable(services) {
        const tableBody = document.querySelector("#services-table tbody");
        tableBody.innerHTML = "";

        services.forEach((service) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${service._id.slice(0, 7)}</td>
                    <td>£${service.price.toFixed(2)}</td>
                    <td>${service.bedrooms}</td>
                    <td>${service.bathrooms}</td>
                    <td>
                        ${service.extraTasks
                          .map((extra) => `${extra}`)
                          .join(", ")}
                    </td>
                    <td>
                        <button class="action-btn btn-warning" onclick="editService('${
                          service._id
                        }')"><i class="fas fa-edit"></i></button>
                        <button class="action-btn btn-danger" onclick="deleteService('${
                          service._id
                        }')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
          tableBody.appendChild(row);
        });
      }

      // Load staff
      async function loadStaff() {
        try {
          const response = await fetch(`${API_BASE}${API_ROUTES.staff}`, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to load staff");
          }

          const data = await response.json();
          staffData = data.staff;

          // Update workers table
          updateWorkersTable();

          return data;
        } catch (error) {
          console.error("Error loading staff:", error);
          showStatusMessage("Failed to load staff", "error");
          throw error;
        }
      }

      // Update workers table
      function updateWorkersTable() {
        const tableBody = document.querySelector("#workers-table tbody");
        tableBody.innerHTML = "";

        staffData.forEach((worker) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${worker.name}</td>
                    <td>${worker.email}</td>
                    <td>${worker.phone}</td>
                    <td>${new Date(worker.joinDate).toLocaleDateString()}</td>
                    <td><span class="status status-${
                      worker.isActive ? "confirmed" : "pending"
                    }">${worker.isActive ? "Active" : "Inactive"}</span></td>
                    <td>
                        <button class="action-btn btn-warning" onclick="editWorker('${
                          worker._id
                        }')"><i class="fas fa-edit"></i></button>
                        <button class="action-btn btn-danger" onclick="deactivateWorker('${
                          worker._id
                        }')">
                            ${worker.isActive ? "Deactivate" : "Activate"}
                        </button>
                    </td>
                `;
          tableBody.appendChild(row);
        });
      }

      // Load applicants
      async function loadApplicants() {
        try {
          const response = await fetch(`${API_BASE}${API_ROUTES.applicants}`, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to load applicants");
          }

          const { data } = await response.json();

          // Update applicants table
          updateApplicantsTable(data);

          return data;
        } catch (error) {
          console.error("Error loading applicants:", error);
          showStatusMessage("Failed to load applicants", "error");
          throw error;
        }
      }

      // Update applicants table
      function updateApplicantsTable(applicants) {
        const tableBody = document.querySelector("#applicants-table tbody");
        tableBody.innerHTML = "";

        applicants.forEach((app) => {
          const row = document.createElement("tr");
          row.dataset.applicantId = app._id;
          row.innerHTML = `
            <td>${app.name}</td>
            <td>${app.email}</td>
            <td>${formatDate(app.createdAt)}</td>
            <td>
                <button class="action-btn btn-success approve-btn">Approve</button>
                <button class="action-btn btn-danger decline-btn">Decline</button>
                <button class="action-btn btn-primary view-btn">View</button>
            </td>
        `;
          tableBody.appendChild(row);
        });
      }

      // Approve applicant
      document.addEventListener("click", async (e) => {
        if (e.target.classList.contains("approve-btn")) {
          const row = e.target.closest("tr");
          const applicantId = row.dataset.applicantId;

          try {
            const response = await fetch(
              `${API_BASE}${API_ROUTES.reviewApplicant(applicantId)}`,
              {
                method: "POST",
                headers: {
                  Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ status: "accepted" }),
              }
            );

            const data = await response.json();

            if (!response.ok) {
              throw new Error("Failed to approve applicant");
            }

            // Remove from applicants table
            row.remove();

            // Reload staff
            // await loadStaff();

            showStatusMessage("Applicant approved successfully!");
          } catch (error) {
            console.error("Error approving applicant:", error);
            showStatusMessage("Failed to approve applicant", "error");
          }
        }

        // Decline applicant
        if (e.target.classList.contains("decline-btn")) {
          const row = e.target.closest("tr");
          const applicantId = row.dataset.applicantId;

          try {
            const response = await fetch(
              `${API_BASE}${API_ROUTES.reviewApplicant(applicantId)}`,
              {
                method: "POST",
                headers: {
                  Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ status: "rejected" }),
              }
            );

            if (!response.ok) {
              throw new Error("Failed to decline applicant");
            }

            // Remove from applicants table
            row.remove();

            showStatusMessage("Applicant declined");
          } catch (error) {
            console.error("Error declining applicant:", error);
            showStatusMessage("Failed to decline applicant", "error");
          }
        }
      });

      // Initialize charts
      function initCharts() {
        // Bookings chart
        const bookingsCtx = document
          .getElementById("bookings-chart")
          .getContext("2d");
        const bookingsChart = new Chart(bookingsCtx, {
          type: "line",
          data: {
            labels: [],
            datasets: [
              {
                label: "Bookings",
                data: [],
                backgroundColor: "rgba(75, 192, 192, 0.2)",
                borderColor: "rgba(75, 192, 192, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });

        // Revenue chart
        const revenueCtx = document
          .getElementById("revenue-chart")
          .getContext("2d");
        const revenueChart = new Chart(revenueCtx, {
          type: "bar",
          data: {
            labels: [],
            datasets: [
              {
                label: "Revenue",
                data: [],
                backgroundColor: "rgba(54, 162, 235, 0.2)",
                borderColor: "rgba(54, 162, 235, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });

        // Satisfaction chart
        const satisfactionCtx = document
          .getElementById("satisfaction-chart")
          .getContext("2d");
        const satisfactionChart = new Chart(satisfactionCtx, {
          type: "doughnut",
          data: {
            labels: [
              "Very Satisfied",
              "Satisfied",
              "Neutral",
              "Unsatisfied",
              "Very Unsatisfied",
            ],
            datasets: [
              {
                data: [20, 30, 10, 5, 2],
                backgroundColor: [
                  "rgba(75, 192, 192, 0.2)",
                  "rgba(54, 162, 235, 0.2)",
                  "rgba(255, 206, 86, 0.2)",
                  "rgba(255, 99, 132, 0.2)",
                  "rgba(153, 102, 255, 0.2)",
                ],
                borderColor: [
                  "rgba(75, 192, 192, 1)",
                  "rgba(54, 162, 235, 1)",
                  "rgba(255, 206, 86, 1)",
                  "rgba(255, 99, 132, 1)",
                  "rgba(153, 102, 255, 1)",
                ],
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
          },
        });

        // Update charts when period changes
        document
          .getElementById("booking-period")
          .addEventListener("change", async (e) => {
            const months = parseInt(e.target.value);
            await updateBookingsChart(bookingsChart, months);
          });

        document
          .getElementById("revenue-period")
          .addEventListener("change", async (e) => {
            const months = parseInt(e.target.value);
            await updateRevenueChart(revenueChart, months);
          });

        document
          .getElementById("satisfaction-period")
          .addEventListener("change", async (e) => {
            const months = parseInt(e.target.value);
            await updateSatisfactionChart(satisfactionChart, months);
          });

        // Initial chart updates
        updateBookingsChart(bookingsChart, 6);
        updateRevenueChart(revenueChart, 1);
        updateSatisfactionChart(satisfactionChart, 3);
      }

      // Update bookings chart
      async function updateBookingsChart(chart, months) {
        try {
          const response = await fetch(
            `${API_BASE}${API_ROUTES.bookings}/stats?months=${months}`,
            {
              headers: {
                Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
              },
            }
          );

          if (!response.ok) {
            throw new Error("Failed to load bookings stats");
          }

          const data = await response.json();

          chart.data.labels = data.labels;
          chart.data.datasets[0].data = data.data;
          chart.update();
        } catch (error) {
          console.error("Error updating bookings chart:", error);
        }
      }

      // Update revenue chart
      async function updateRevenueChart(chart, months) {
        try {
          const response = await fetch(
            `${API_BASE}${API_ROUTES.bookings}/revenue?months=${months}`,
            {
              headers: {
                Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
              },
            }
          );

          if (!response.ok) {
            throw new Error("Failed to load revenue stats");
          }

          const data = await response.json();

          chart.data.labels = data.labels;
          chart.data.datasets[0].data = data.data;
          chart.update();
        } catch (error) {
          console.error("Error updating revenue chart:", error);
        }
      }

      // Update satisfaction chart
      async function updateSatisfactionChart(chart, months) {
        try {
          const response = await fetch(
            `${API_BASE}${API_ROUTES.completedJobs}/satisfaction?months=${months}`,
            {
              headers: {
                Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
              },
            }
          );

          if (!response.ok) {
            throw new Error("Failed to load satisfaction stats");
          }

          const data = await response.json();

          chart.data.datasets[0].data = data;
          chart.update();
        } catch (error) {
          console.error("Error updating satisfaction chart:", error);
        }
      }

      // Set up event listeners
      function setupEventListeners() {
        // Sidebar navigation
        document.querySelectorAll(".menu-item").forEach((item) => {
          item.addEventListener("click", function () {
            document
              .querySelectorAll(".menu-item")
              .forEach((i) => i.classList.remove("active"));
            this.classList.add("active");
            document.querySelectorAll(".section-content").forEach((section) => {
              section.style.display = "none";
            });
            const sectionId = this.getAttribute("data-section") + "-section";
            document.getElementById(sectionId).style.display = "block";
          });
        });

        // Staff tab switching
        document.querySelectorAll(".tab-nav button").forEach((btn) => {
          btn.addEventListener("click", () => {
            document
              .querySelectorAll(".tab-nav button")
              .forEach((b) => b.classList.remove("active-tab"));
            btn.classList.add("active-tab");
            document
              .querySelectorAll(".staff-tab")
              .forEach((tab) => tab.classList.remove("active"));
            document
              .getElementById(btn.dataset.tab + "-tab")
              .classList.add("active");
          });
        });

        // Modal handling
        document.querySelectorAll(".close-modal").forEach((btn) => {
          btn.addEventListener("click", () => {
            document
              .querySelectorAll(".modal")
              .forEach((modal) => (modal.style.display = "none"));
          });
        });

        window.addEventListener("click", (e) => {
          if (e.target.classList.contains("modal")) {
            document
              .querySelectorAll(".modal")
              .forEach((modal) => (modal.style.display = "none"));
          }
        });

        // Add booking button
        document
          .getElementById("add-booking-btn")
          .addEventListener("click", () => {
            document.getElementById("add-booking-modal").style.display = "flex";
          });

        // Add service button
        document
          .getElementById("add-service-btn")
          .addEventListener("click", () => {
            document.getElementById("add-service-modal").style.display = "flex";
          });

        // Add extra service button
        document
          .getElementById("add-extra-btn")
          .addEventListener("click", () => {
            document.getElementById("add-extra-modal").style.display = "flex";
          });

        // Add booking form submission
        document
          .getElementById("add-booking-form")
          .addEventListener("submit", async (e) => {
            e.preventDefault();

            try {
              const customerId =
                document.getElementById("booking-customer").value;
              const serviceId =
                document.getElementById("booking-service").value;
              const bedrooms = parseInt(
                document.getElementById("booking-bedrooms").value
              );
              const bathrooms = parseInt(
                document.getElementById("booking-bathrooms").value
              );
              const date = document.getElementById("booking-date").value;
              const time = document.getElementById("booking-time").value;
              const notes = document.getElementById("booking-notes").value;

              // Get selected extras
              const extras = [];
              document
                .querySelectorAll(
                  '#booking-extras-container input[type="checkbox"]:checked'
                )
                .forEach((checkbox) => {
                  extras.push(checkbox.value);
                });

              const response = await fetch(
                `${API_BASE}${API_ROUTES.bookings}`,
                {
                  method: "POST",
                  headers: {
                    Authorization: `Bearer ${localStorage.getItem(
                      "adminToken"
                    )}`,
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({
                    customerId,
                    serviceId,
                    bedrooms,
                    bathrooms,
                    extras,
                    dateTime: `${date}T${time}`,
                    notes,
                  }),
                }
              );

              if (!response.ok) {
                throw new Error("Failed to create booking");
              }

              // Close modal
              document.getElementById("add-booking-modal").style.display =
                "none";

              // Reload bookings
              await loadBookings();

              showStatusMessage("Booking created successfully!");
            } catch (error) {
              console.error("Error creating booking:", error);
              showStatusMessage("Failed to create booking", "error");
            }
          });

        // Add service form submission
        document
          .getElementById("add-service-form")
          .addEventListener("submit", async (e) => {
            e.preventDefault();

            try {
              const name = document.getElementById("service-name").value;
              const basePrice = parseFloat(
                document.getElementById("service-base-price").value
              );
              const bedroomRate = parseFloat(
                document.getElementById("service-bedroom-rate").value
              );
              const bathroomRate = parseFloat(
                document.getElementById("service-bathroom-rate").value
              );
              const description = document.getElementById(
                "service-description"
              ).value;

              // Get extras (would need to be implemented)
              const extras = [];

              const response = await fetch(
                `${API_BASE}${API_ROUTES.services}`,
                {
                  method: "POST",
                  headers: {
                    Authorization: `Bearer ${localStorage.getItem(
                      "adminToken"
                    )}`,
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({
                    name,
                    basePrice,
                    bedroomRate,
                    bathroomRate,
                    description,
                    extras,
                  }),
                }
              );

              if (!response.ok) {
                throw new Error("Failed to create service");
              }

              // Close modal
              document.getElementById("add-service-modal").style.display =
                "none";

              // Reload services
              await loadServices();

              showStatusMessage("Service created successfully!");
            } catch (error) {
              console.error("Error creating service:", error);
              showStatusMessage("Failed to create service", "error");
            }
          });

        // Add extra service form submission
        document
          .getElementById("add-extra-form")
          .addEventListener("submit", async (e) => {
            e.preventDefault();

            try {
              const name = document.getElementById("extra-name").value;
              const price = parseFloat(
                document.getElementById("extra-price").value
              );
              const description =
                document.getElementById("extra-description").value;

              // In a real implementation, this would add to the current service being edited
              // For now, just close the modal
              document.getElementById("add-extra-modal").style.display = "none";

              showStatusMessage("Extra service added!");
            } catch (error) {
              console.error("Error adding extra service:", error);
              showStatusMessage("Failed to add extra service", "error");
            }
          });

        // Change password form submission
        document
          .getElementById("password-form")
          .addEventListener("submit", async (e) => {
            e.preventDefault();

            try {
              const currentPassword =
                document.getElementById("current-password").value;
              const newPassword = document.getElementById("new-password").value;
              const confirmPassword =
                document.getElementById("confirm-password").value;

              if (newPassword !== confirmPassword) {
                throw new Error("Passwords do not match");
              }

              const response = await fetch(
                `${API_BASE}${API_ROUTES.changePassword}`,
                {
                  method: "POST",
                  headers: {
                    Authorization: `Bearer ${localStorage.getItem(
                      "adminToken"
                    )}`,
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({
                    currentPassword,
                    newPassword,
                  }),
                }
              );

              if (!response.ok) {
                throw new Error("Failed to change password");
              }

              // Clear form
              document.getElementById("password-form").reset();

              showStatusMessage("Password changed successfully!");
            } catch (error) {
              console.error("Error changing password:", error);
              showStatusMessage(error.message, "error");
            }
          });

        // Pagination buttons
        document
          .getElementById("bookings-prev-btn")
          .addEventListener("click", () => {
            if (bookingsCurrentPage > 1) {
              loadBookings(bookingsCurrentPage - 1);
            }
          });

        document
          .getElementById("bookings-next-btn")
          .addEventListener("click", () => {
            loadBookings(bookingsCurrentPage + 1);
          });

        document
          .getElementById("jobs-prev-btn")
          .addEventListener("click", () => {
            if (jobsCurrentPage > 1) {
              loadCompletedJobs(jobsCurrentPage - 1);
            }
          });

        document
          .getElementById("jobs-next-btn")
          .addEventListener("click", () => {
            loadCompletedJobs(jobsCurrentPage + 1);
          });

        // Logout button
        document
          .getElementById("logout-btn")
          .addEventListener("click", async () => {
            try {
              const response = await fetch(`${API_BASE}${API_ROUTES.logout}`, {
                method: "POST",
                headers: {
                  Authorization: `Bearer ${localStorage.getItem("adminToken")}`,
                },
              });

              // Clear token and redirect to login
              localStorage.removeItem("adminToken");
              window.location.href = "/admin/login";
            } catch (error) {
              console.error("Error logging out:", error);
              showStatusMessage("Failed to logout", "error");
            }
          });
      }

      // Show status message
      function showStatusMessage(message, type = "success") {
        const statusDiv = document.createElement("div");
        statusDiv.className = "status-message";
        statusDiv.textContent = message;
        statusDiv.style.backgroundColor =
          type === "success" ? "var(--success-color)" : "var(--danger-color)";

        document.body.appendChild(statusDiv);

        setTimeout(() => {
          statusDiv.remove();
        }, 3000);
      }

      // Placeholder functions for future implementation
      function viewBookingDetails(bookingId) {
        console.log("View booking details:", bookingId);
        showStatusMessage(
          "View booking details functionality to be implemented"
        );
      }

      function confirmBooking(bookingId) {
        console.log("Confirm booking:", bookingId);
        showStatusMessage("Confirm booking functionality to be implemented");
      }

      function cancelBooking(bookingId) {
        console.log("Cancel booking:", bookingId);
        showStatusMessage("Cancel booking functionality to be implemented");
      }

      function editBooking(bookingId) {
        console.log("Edit booking:", bookingId);
        showStatusMessage("Edit booking functionality to be implemented");
      }

      function viewCustomerDetails(customerId) {
        console.log("View customer details:", customerId);
        showStatusMessage(
          "View customer details functionality to be implemented"
        );
      }

      function editCustomer(customerId) {
        console.log("Edit customer:", customerId);
        showStatusMessage("Edit customer functionality to be implemented");
      }

      function deleteCustomer(customerId) {
        console.log("Delete customer:", customerId);
        showStatusMessage("Delete customer functionality to be implemented");
      }

      function editService(serviceId) {
        console.log("Edit service:", serviceId);
        showStatusMessage("Edit service functionality to be implemented");
      }

      function deleteService(serviceId) {
        console.log("Delete service:", serviceId);
        showStatusMessage("Delete service functionality to be implemented");
      }

      function editWorker(workerId) {
        console.log("Edit worker:", workerId);
        showStatusMessage("Edit worker functionality to be implemented");
      }

      function deactivateWorker(workerId) {
        console.log("Deactivate worker:", workerId);
        showStatusMessage("Deactivate worker functionality to be implemented");
      }

      function viewApplicant(applicantId) {
        console.log("View applicant:", applicantId);
        showStatusMessage("View applicant functionality to be implemented");
      }

      function formatDate(dateString) {
        if (!dateString) return "Not specified";
        const date = new Date(dateString);
        return date.toLocaleDateString("en-GB", {
          weekday: "short",
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      }
    </script>
  </body>
</html>
